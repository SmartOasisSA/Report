<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Oasis | æ²™ç‰¹æ”¿åºœå…³ç³»æˆ˜ç•¥ç³»ç»Ÿ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Noto Sans SC) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config for Custom Palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans SC"', 'sans-serif'],
                    },
                    colors: {
                        'sand-50': '#f9f7f2',
                        'sand-100': '#f0eadd',
                        'sand-200': '#e2d6c0',
                        'saudi-green': '#1e5f44',
                        'saudi-green-light': '#2d8a63',
                        'gold-accent': '#c5a065',
                        'slate-dark': '#334155',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in-right': 'slideInRight 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    },
                    boxShadow: {
                        'card': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'floating': '0 10px 40px -10px rgba(30, 95, 68, 0.15)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f0eadd; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c5a065; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #1e5f44; 
        }

        /* Transitions */
        .transition-all-300 {
            transition: all 0.3s ease-in-out;
        }

        /* Ecosystem Tree Styles */
        .eco-node {
            position: relative;
            z-index: 10;
            transition: all 0.3s ease;
        }
        .eco-node:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .connector-v {
            width: 2px;
            background-color: #e2d6c0; /* sand-200 */
            margin: 0 auto;
            position: relative;
        }
        
        /* Accordion Animation */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] summary ~ * {
            animation: sweep .3s ease-in-out;
        }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-10px)}
            100%  {opacity: 1; transform: translateY(0)}
        }

        /* AI Chat Bubble Styles */
        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
        }
        .chat-bubble.user {
            background-color: #1e5f44;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .chat-bubble.ai {
            background-color: #ffffff;
            color: #334155;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            border: 1px solid #e2d6c0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .typing-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #888;
            animation: typing 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-sand-50 text-slate-dark font-sans antialiased overflow-hidden h-screen flex flex-col lg:flex-row">

    <!-- Mobile Nav Toggle -->
    <div class="lg:hidden bg-saudi-green text-white p-4 flex justify-between items-center shadow-md fixed w-full z-50 top-0 h-16">
        <div class="flex items-center gap-2">
            <div class="h-6 w-6 bg-white/10 rounded flex items-center justify-center text-xs font-bold text-gold-accent border border-gold-accent/30">S</div>
            <h1 class="text-lg font-bold">Smart Oasis</h1>
        </div>
        <button id="menu-btn" class="text-white focus:outline-none text-2xl">â˜°</button>
    </div>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="bg-saudi-green text-white w-64 space-y-6 py-4 px-2 absolute inset-y-0 left-0 transform -translate-x-full lg:relative lg:translate-x-0 transition duration-300 ease-in-out z-40 h-full flex flex-col pt-20 lg:pt-6 shadow-2xl lg:shadow-none border-r border-saudi-green-light/30">
        <div class="px-4 mb-6 hidden lg:block">
            <div class="flex items-center gap-3 mb-2">
                <div class="h-10 w-10 bg-white/10 rounded-lg text-gold-accent flex items-center justify-center font-bold text-xl shadow-lg border border-gold-accent/40 backdrop-blur-sm">S</div>
                <div>
                    <h2 class="text-xl font-bold tracking-wide leading-none">Smart Oasis</h2>
                    <p class="text-[10px] text-sand-200 mt-1 uppercase tracking-wider opacity-80">Knowledge Base</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 space-y-1 overflow-y-auto px-2">
            <a href="#" onclick="showSection('dashboard')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white bg-white/10 font-bold flex items-center gap-3 mb-1" data-target="dashboard">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                ç”Ÿæ€å…¨æ™¯å›¾
            </a>
            <a href="#" onclick="showSection('workflow')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white flex items-center gap-3 mb-1" data-target="workflow">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                ä¸šåŠ¡æµç¨‹
            </a>
            <a href="#" onclick="showSection('directory')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white flex items-center gap-3 mb-1" data-target="directory">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                æœºæ„ç™¾ç§‘å…¨ä¹¦
            </a>
            <a href="#" onclick="showSection('legal')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white flex items-center gap-3 mb-1" data-target="legal">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                æ³•å¾‹æ³•è§„åº“
            </a>
        </nav>

        <!-- AI Button in Sidebar -->
        <div class="px-4 pb-6 mt-auto">
            <button onclick="toggleAIChat()" class="w-full py-3 px-4 bg-gradient-to-r from-gold-accent to-yellow-700 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all flex items-center justify-center space-x-2 font-bold group border border-white/10">
                <span class="text-xl group-hover:animate-pulse">âœ¨</span>
                <span>æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹</span>
            </button>
        </div>

        <div class="p-4 text-[10px] text-sand-200/60 border-t border-white/10">
            <p>Version 2.0 | Dec 2025</p>
            <p class="font-mono mt-1">INTERNAL USE ONLY</p>
        </div>
    </aside>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebar-overlay" onclick="document.getElementById('sidebar').classList.add('-translate-x-full'); document.getElementById('sidebar-overlay').classList.add('hidden');" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden backdrop-blur-sm"></div>

    <!-- Main Content -->
    <main class="flex-1 w-full lg:ml-0 transition-all-300 h-full flex flex-col relative bg-sand-50">
        <div class="flex-1 overflow-y-auto p-4 lg:p-10 scroll-smooth">
            <div class="max-w-7xl mx-auto space-y-8 pb-12 pt-16 lg:pt-0">
                
                <!-- VIEW 1: ECOSYSTEM PANORAMA -->
                <div id="dashboard" class="section-content block animate-fade-in">
                    <!-- Header -->
                    <header class="mb-8 border-b-2 border-gold-accent pb-6">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-end gap-4">
                            <div>
                                <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green tracking-tight">æ²™ç‰¹æˆ¿åœ°äº§æƒåŠ›ç”Ÿæ€å…¨æ™¯</h1>
                                <p class="mt-2 text-slate-600">
                                    ç†æ¸…æ²™ç‰¹æ”¿åºœæœºæ„çš„éš¶å±ã€ç›‘ç®¡ä¸æ‰§è¡Œå…³ç³»ï¼Œè¯†åˆ«â€œè£åˆ¤å‘˜â€ä¸â€œè¿åŠ¨å‘˜â€ã€‚
                                </p>
                            </div>
                            <div class="text-right hidden md:block">
                                <span class="bg-saudi-green/10 text-saudi-green px-3 py-1 rounded-full text-xs font-bold">Updated: 2025.12</span>
                            </div>
                        </div>
                    </header>

                    <!-- Admin System Comparison (Expandable) -->
                    <div class="bg-white rounded-xl border border-sand-200 shadow-card overflow-hidden mb-10 group hover:shadow-md transition-shadow">
                        <details class="group">
                            <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-5 bg-gradient-to-r from-sand-50 to-white hover:bg-sand-100 transition-colors">
                                <span class="text-saudi-green font-bold flex items-center gap-3 text-lg">
                                    <div class="p-1.5 bg-saudi-green/10 rounded-full">
                                        <svg class="w-5 h-5 text-saudi-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    æ²™ç‰¹è¡Œæ”¿ä½“ç³» vs ä¸­å›½ä½“ç³» (å·®å¼‚å¯¹æ¯”)
                                </span>
                                <span class="transition-transform duration-300 group-open:rotate-180 text-saudi-green bg-white rounded-full p-1 shadow-sm">
                                    <svg fill="none" height="20" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20"><path d="M6 9l6 6 6-6"></path></svg>
                                </span>
                            </summary>
                            <div class="text-gray-600 text-sm p-6 border-t border-sand-200 leading-relaxed bg-white">
                                <div class="w-full">
                                    <h4 class="font-bold text-slate-800 mb-4 text-base border-l-4 border-gold-accent pl-3">æ ¸å¿ƒé€»è¾‘å·®å¼‚</h4>
                                    <p class="mb-4 text-slate-600">æ²™ç‰¹è¡Œæ”¿ä½“ç³»æ²¡æœ‰ä¸­å›½ä¸¥æ ¼çš„â€œçœå…-å¸‚å±€-å¿å±€â€å‚ç›´ç®¡ç†ä½“ç³»ï¼Œè€Œæ˜¯å‘ˆç°<strong>â€œä¸­å¤®éƒ¨å§”å†³ç­– + å¼ºåŠ›æ€»å±€ç›‘ç®¡ + åœ°åŒºå¸‚æ”¿ç½²æ‰§è¡Œâ€</strong>çš„æ‰å¹³åŒ–æ ¼å±€ã€‚</p>
                                    <ul class="space-y-4 text-slate-600">
                                        <li class="flex flex-col sm:flex-row sm:gap-4">
                                            <span class="font-bold text-saudi-green min-w-[140px]">å†³ç­–å±‚ï¼ˆMinistry / éƒ¨ï¼‰:</span>
                                            <span>ç±»ä¼¼ä¸­å›½çš„ä¸­å¤®éƒ¨å§”ï¼ˆå¦‚ä½å»ºéƒ¨ï¼‰ã€‚ä¸»è¦è´Ÿè´£åˆ¶å®šå›½å®¶æˆ˜ç•¥ã€å®è§‚æ”¿ç­–å’Œæ³•å¾‹æ¡†æ¶ï¼Œé€šå¸¸ä¸ç›´æ¥å¤„ç†å…·ä½“ä¼ä¸šçš„çäº‹ã€‚</span>
                                        </li>
                                        <li class="flex flex-col sm:flex-row sm:gap-4">
                                            <span class="font-bold text-gold-accent min-w-[140px]">ç›‘ç®¡å±‚ï¼ˆAuthority / æ€»å±€ï¼‰:</span>
                                            <span>æˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å±‚çº§ã€‚å®ƒä»¬å¾€å¾€æ‹¥æœ‰æé«˜çš„ç‹¬ç«‹æ€§å’Œæ‰§æ³•æƒï¼Œä¸“é—¨è´Ÿè´£æŸä¸ªå‚ç›´é¢†åŸŸçš„å‘ç‰Œã€ç›‘ç®¡å’Œå¤„ç½šï¼ˆå¦‚æˆ¿åœ°äº§æ€»å±€REGAï¼‰ï¼Œç±»ä¼¼äºä¸­å›½çš„â€œé“¶ä¿ç›‘ä¼šâ€æˆ–â€œè¯ç›‘ä¼šâ€åœ¨ç‰¹å®šè¡Œä¸šçš„è§’è‰²ã€‚</span>
                                        </li>
                                        <li class="flex flex-col sm:flex-row sm:gap-4">
                                            <span class="font-bold text-slate-500 min-w-[140px]">æ‰§è¡Œå±‚ï¼ˆAmanah / å¸‚æ”¿ç½²ï¼‰:</span>
                                            <span>æ²™ç‰¹æ²¡æœ‰â€œçœæˆ¿ç®¡å±€â€ï¼Œåœ°æ–¹ä¸Šçš„å…·ä½“æ‰§è¡Œï¼ˆå¦‚å‘æ–½å·¥è¯ã€ä¿®è·¯ã€æ”¶åƒåœ¾ï¼‰å…¨éƒ¨ç”±å„åŸå¸‚çš„ Amanah è´Ÿè´£ã€‚</span>
                                        </li>
                                        <li class="flex flex-col sm:flex-row sm:gap-4">
                                            <span class="font-bold text-slate-500 min-w-[140px]">G.R.E.s (å›½å®¶é˜Ÿ):</span>
                                            <span>ç±»ä¼¼ä¸­å›½çš„å¤®ä¼ï¼ˆå¦‚ä¸­å»ºã€ä¸­é“ï¼‰ï¼Œä½†åœ¨æ²™ç‰¹ï¼Œå®ƒä»¬æ‰¿æ‹…äº†éƒ¨åˆ†â€œæ”¿åºœèŒèƒ½â€ï¼Œå¦‚å›½å®¶ä½æˆ¿å…¬å¸ï¼ˆNHCï¼‰ï¼Œæ—¢æ˜¯æˆ‘ä»¬çš„ç«äº‰å¯¹æ‰‹ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€å¤§çš„åˆä½œä¼™ä¼´ã€‚</span>
                                        </li>                                        
                                    </ul>
                                </div>
                            </div>
                        </details>
                    </div>

                    <!-- Vertical Ecosystem Tree -->
                    <div class="bg-white rounded-xl p-8 lg:p-12 border border-sand-200 shadow-card flex justify-center overflow-x-auto relative min-h-[600px]">
                        <!-- Background Grid Pattern -->
                        <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(#1e5f44 1px, transparent 1px); background-size: 20px 20px;"></div>

                        <div class="w-full max-w-5xl flex flex-col items-center gap-8 min-w-[700px] relative z-10">
                            
                            <!-- Level 1: King -->
                            <div class="eco-node bg-saudi-green text-white px-10 py-4 rounded-lg shadow-floating text-center min-w-[240px] border-b-4 border-gold-accent">
                                <div class="font-bold text-xl tracking-wide">å›½ç‹ / å†…é˜</div>
                                <div class="text-[10px] opacity-80 uppercase tracking-widest mt-1">Council of Ministers</div>
                            </div>

                            <!-- Connector -->
                            <div class="h-10 connector-v"></div>

                            <!-- Level 2: Top Strategies (Split) -->
                            <div class="grid grid-cols-2 gap-16 w-full relative">
                                <!-- Horizontal Connector for Level 2 -->
                                <div class="absolute top-0 left-1/4 right-1/4 h-0.5 bg-sand-200 -mt-10 hidden md:block rounded-full"></div> 
                                <div class="absolute top-0 left-1/4 h-10 w-0.5 bg-sand-200 -mt-10 hidden md:block"></div>
                                <div class="absolute top-0 right-1/4 h-10 w-0.5 bg-sand-200 -mt-10 hidden md:block"></div>

                                <!-- Left: MOMAH System (Complex) -->
                                <div class="flex flex-col items-center">
                                    <div class="eco-node bg-sand-50 border-2 border-saudi-green-light/20 p-5 rounded-lg shadow-sm text-center w-full max-w-[320px]">
                                        <div class="font-bold text-saudi-green text-lg">MOMAH å¸‚æ”¿ä¸ä½æˆ¿éƒ¨</div>
                                        <div class="text-xs text-saudi-green-light mt-1 font-bold bg-white/50 inline-block px-2 py-0.5 rounded">æˆ¿åœ°äº§æœ€é«˜ä¸»ç®¡éƒ¨é—¨</div>
                                    </div>
                                    
                                    <div class="h-8 connector-v"></div>

                                    <!-- MOMAH Sub-entities Grid -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full relative">
                                        <!-- Horizontal Line for MOMAH children -->
                                        <div class="absolute top-0 left-6 right-6 h-0.5 bg-sand-200 -mt-8 hidden md:block"></div>
                                        <div class="absolute top-0 left-1/2 h-8 w-0.5 bg-sand-200 -mt-8 hidden md:block"></div>
                                        <div class="absolute top-0 left-6 h-8 w-0.5 bg-sand-200 -mt-8 hidden md:block"></div>
                                        <div class="absolute top-0 right-6 h-8 w-0.5 bg-sand-200 -mt-8 hidden md:block"></div>

                                        <!-- REGA (Regulator) -->
                                        <div class="flex flex-col items-center">
                                            <div class="eco-node bg-white border-t-4 border-gold-accent p-3 rounded shadow-sm text-center w-full border border-sand-100">
                                                <div class="font-bold text-slate-800">REGA æˆ¿äº§æ€»å±€</div>
                                                <div class="text-[10px] text-white bg-gold-accent px-2 py-0.5 rounded-full inline-block mt-1 font-bold">è¡Œä¸šç›‘ç®¡</div>
                                            </div>
                                            <div class="h-4 connector-v"></div>
                                            <div class="bg-sand-50 border border-sand-200 rounded p-3 w-full space-y-2 shadow-inner">
                                                <div class="text-[10px] text-center font-bold text-gray-400 uppercase">ä¸‹å±å¹³å°</div>
                                                <div class="grid gap-1.5">
                                                    <div class="bg-white border border-sand-100 rounded px-2 py-1.5 text-xs text-center text-slate-600 font-medium hover:text-saudi-green hover:border-saudi-green cursor-default transition-colors">Ejar (ç§Ÿèµ)</div>
                                                    <div class="bg-white border border-sand-100 rounded px-2 py-1.5 text-xs text-center text-slate-600 font-medium hover:text-saudi-green hover:border-saudi-green cursor-default transition-colors">Wafi (æœŸæˆ¿)</div>
                                                    <div class="bg-white border border-sand-100 rounded px-2 py-1.5 text-xs text-center text-slate-600 font-medium hover:text-saudi-green hover:border-saudi-green cursor-default transition-colors">Mullak (ç‰©ä¸š)</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- NHC (Partner) -->
                                        <div class="flex flex-col items-center">
                                            <div class="eco-node bg-white border-2 border-green-600 border-dashed p-4 rounded shadow-sm text-center w-full border border-sand-100 h-full flex flex-col justify-center">
                                                <div class="font-bold text-slate-800">NHC å›½å®¶ä½æˆ¿å…¬å¸</div>
                                                <div class="text-xs text-green-600 font-bold mt-1">æœ€å¤§åœ°ä¸» / å›½ä¼</div>
                                            </div>
                                        </div>

                                        <!-- Etmam (Service) -->
                                        <div class="flex flex-col items-center">
                                            <div class="eco-node bg-white border-t-4 border-saudi-green-light p-3 rounded shadow-sm text-center w-full border border-sand-100">
                                                <div class="font-bold text-slate-800">Etmam æœåŠ¡ä¸­å¿ƒ</div>
                                                <div class="text-[10px] text-white bg-saudi-green-light px-2 py-0.5 rounded-full inline-block mt-1 font-bold">ç»¿è‰²é€šé“</div>
                                            </div>
                                            <div class="h-4 connector-v"></div>
                                            <div class="bg-white border border-sand-200 rounded p-2 text-xs text-center w-full text-slate-600 font-bold shadow-sm">
                                                Balady <br><span class="text-[10px] font-normal text-gray-400">æŠ€æœ¯å¹³å°</span>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            
                                <!-- Right: RCRC System -->
                                <div class="flex flex-col items-center group">
                                    <div class="eco-node bg-white border-t-4 border-saudi-green p-5 rounded-lg shadow-sm text-center w-full max-w-[280px] border border-sand-100 hover:border-saudi-green/30">
                                        <div class="font-bold text-slate-800 text-lg">RCRC åˆ©é›…å¾—çš‡å®¶å§”å‘˜ä¼š</div>
                                        <div class="text-xs text-gray-400 mt-1 font-medium bg-gray-50 inline-block px-2 py-0.5 rounded">åˆ©é›…å¾—é¡¶å±‚æˆ˜ç•¥è®¾è®¡</div>
                                    </div>
                                    <div class="h-8 connector-v"></div>
                                    <div class="eco-node bg-white border-l-4 border-slate-500 p-4 rounded shadow-sm text-center w-full max-w-[220px] border border-sand-100">
                                        <div class="font-bold text-slate-800">Riyadh Amanah</div>
                                        <div class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">å¸‚æ”¿ç½² (æ‰§è¡Œ)</div>
                                        <div class="text-[10px] text-gray-400 border-t border-gray-100 pt-1">å‘è¯ / éªŒæ”¶ / æ‰§æ³•</div>
                                    </div>
                                </div>

                            <!-- External Supports -->
                            <div class="w-full border-t-2 border-dashed border-sand-200 pt-8 mt-6">
                                <div class="text-center text-xs text-gray-400 mb-4 font-bold uppercase tracking-widest bg-white inline-block px-4 -mt-11 mx-auto relative z-20">å…³é”®å¤–éƒ¨åä½œæœºæ„</div>
                                <div class="flex flex-wrap justify-center gap-4">
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">MISA æŠ•èµ„éƒ¨</div>
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">MC å•†åŠ¡éƒ¨</div>
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">ZATCA ç¨åŠ¡å±€</div>
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">Civil Defense æ°‘é˜²</div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- VIEW 2: WORKFLOW -->
                <div id="workflow" class="section-content hidden animate-fade-in">
                    <header class="mb-8 border-b-2 border-gold-accent pb-4">
                        <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green">ä¸šåŠ¡å…¨æµç¨‹äº¤äº’æŒ‡å¼•</h1>
                        <p class="mt-4 text-base md:text-lg text-slate-600 leading-relaxed">
                            ä»å…¬å¸è®¾ç«‹åˆ°äº§ç”Ÿæ”¶å…¥çš„ä¸»è¦åˆè§„èŠ‚ç‚¹ï¼Œæ¯ä¸€æ­¥éƒ½å…³ä¹é¡¹ç›®æˆè´¥ã€‚
                        </p>
                    </header>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                        <!-- Step List -->
                        <div class="lg:col-span-4 space-y-3" id="workflow-steps-container">
                            <!-- JS Injected -->
                        </div>
                        <!-- Detail View -->
                        <div class="lg:col-span-8 bg-white border border-sand-200 rounded-xl p-8 shadow-card relative overflow-hidden flex flex-col justify-center min-h-[400px]" id="workflow-content">
                            <!-- JS Injected -->
                        </div>
                    </div>
                </div>

                <!-- VIEW 3: DIRECTORY (Expanded to all 16) -->
                <div id="directory" class="section-content hidden animate-fade-in">
                    <header class="mb-8 border-b-2 border-gold-accent pb-6 flex flex-col md:flex-row justify-between items-end gap-4">
                        <div>
                            <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green">æœºæ„ç™¾ç§‘å…¨ä¹¦</h1>
                            <p class="mt-2 text-base text-slate-600 leading-relaxed">
                                æ”¶å½• 16 ä¸ªæ ¸å¿ƒç›¸å…³çš„éƒ¨å§”ã€æ€»å±€ã€å¹³å°ä¸å›½ä¼ã€‚
                            </p>
                        </div>
                        <div class="relative w-full md:w-72">
                            <input type="text" id="searchInput" placeholder="æœç´¢æœºæ„åç§°æˆ–ç¼©å†™..." class="pl-10 pr-4 py-2.5 border border-sand-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-saudi-green w-full text-sm bg-white shadow-sm">
                            <svg class="w-4 h-4 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </header>

                    <!-- Type Filters -->
                    <div class="flex flex-wrap gap-2 mb-8" id="filter-container"></div>

                    <!-- Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5" id="directory-grid">
                        <!-- Cards JS Injected -->
                    </div>
                </div>

                <!-- VIEW 4: LEGAL LIBRARY (Refined) -->
                <div id="legal" class="section-content hidden animate-fade-in">
                    <header class="mb-8 border-b-2 border-gold-accent pb-4">
                        <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green">æˆ¿åœ°äº§æ³•å¾‹æ³•è§„åº“</h1>
                        <p class="mt-4 text-base md:text-lg text-slate-600 leading-relaxed">
                            ä¸ Smart Oasis ä¸šåŠ¡ç´§å¯†ç›¸å…³çš„ç°è¡Œæ³•å¾‹æ¡†æ¶ä¸åˆè§„è¦ç‚¹ã€‚
                        </p>
                    </header>
                    
                    <div class="space-y-4 max-w-4xl" id="legal-list">
                        <!-- JS Injected -->
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- AI Chat Widget -->
    <div id="ai-chat-panel" class="fixed top-0 right-0 h-full w-full md:w-[400px] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col border-l border-sand-200">
        <!-- Header -->
        <div class="bg-saudi-green p-4 flex justify-between items-center text-white shadow-md">
            <div class="flex items-center space-x-3">
                <div class="bg-white/10 p-1.5 rounded-lg">
                    <span class="text-xl">âœ¨</span>
                </div>
                <div>
                    <h3 class="font-bold text-lg">æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹</h3>
                    <p class="text-[10px] text-saudi-green-light opacity-90 uppercase tracking-wider">Powered by Gemini 2.5</p>
                </div>
            </div>
            <button onclick="toggleAIChat()" class="hover:bg-white/10 p-2 rounded-lg transition text-white/80 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        
        <!-- Chat Area -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 bg-sand-50/50 flex flex-col space-y-4">
            <div class="chat-bubble ai animate-fade-in">
                ä½ å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ Smart Oasis å†…éƒ¨çŸ¥è¯†åŠ©æ‰‹ã€‚
                <br><br>
                æ‚¨å¯ä»¥é—®æˆ‘å…³äº<strong>æœºæ„èŒèƒ½ï¼ˆå¦‚REGA, MOMAHï¼‰ã€åŠäº‹æµç¨‹ã€æˆ–æ³•å¾‹æ³•è§„</strong>çš„é—®é¢˜ã€‚
            </div>
            
            <!-- Suggested Questions -->
            <div class="flex flex-wrap gap-2 mt-2 px-1">
                <button onclick="askQuestion('REGAå’ŒMOMAHæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ')" class="text-xs bg-white border border-sand-200 px-3 py-1.5 rounded-full hover:border-saudi-green hover:text-saudi-green transition shadow-sm">ğŸ›ï¸ REGA vs MOMAH</button>
                <button onclick="askQuestion('æ‹¿åœ°å¼€å‘çš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ')" class="text-xs bg-white border border-sand-200 px-3 py-1.5 rounded-full hover:border-saudi-green hover:text-saudi-green transition shadow-sm">ğŸ—ï¸ å¼€å‘æµç¨‹</button>
                <button onclick="askQuestion('å¤–å›½æŠ•èµ„è€…å¦‚ä½•è¿›å…¥æ²™ç‰¹å¸‚åœºï¼Ÿ')" class="text-xs bg-white border border-sand-200 px-3 py-1.5 rounded-full hover:border-saudi-green hover:text-saudi-green transition shadow-sm">ğŸŒ å¸‚åœºå‡†å…¥</button>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-gray-200">
            <div class="relative">
                <input type="text" id="user-input" class="w-full border border-gray-300 rounded-xl pl-4 pr-12 py-3 focus:outline-none focus:border-saudi-green focus:ring-1 focus:ring-saudi-green transition shadow-inner bg-gray-50 focus:bg-white" placeholder="è¾“å…¥é—®é¢˜..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()" class="absolute right-2 top-2 bg-saudi-green text-white p-1.5 rounded-lg hover:bg-saudi-green-light transition shadow-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div class="text-[10px] text-gray-400 text-center mt-2">
                AIç”Ÿæˆå†…å®¹å¯èƒ½åŒ…å«é”™è¯¯ï¼Œè¯·ä»¥å®˜æ–¹æ–‡ä»¶ä¸ºå‡†ã€‚
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div id="chat-overlay" onclick="toggleAIChat()" class="fixed inset-0 bg-black/30 z-40 hidden transition-opacity duration-300 backdrop-blur-sm"></div>

    <!-- JS Logic -->
    <script>
        // --- DATASET ---
        const agencyData = [
            { 
                id: 'momah', 
                name: 'å¸‚æ”¿ä¸ä½æˆ¿éƒ¨', 
                abbr: 'MOMAH', 
                type: 'ministry', 
                role: 'æ ¸å¿ƒä¸»ç®¡ / è¶…çº§éƒ¨å§”', 
                desc: 'æˆ¿åœ°äº§æœ€é«˜ä¸»ç®¡éƒ¨é—¨ï¼Œç”±åŸå¸‚æ”¿éƒ¨ä¸ä½æˆ¿éƒ¨åˆå¹¶è€Œæˆã€‚å†…é˜æ ¸å¿ƒéƒ¨å§”ï¼Œä½“é‡åºå¤§ã€‚', 
                details: '<strong>ç”Ÿæ€ä½ï¼š</strong>æ—¢ç®¡å®è§‚æ”¿ç­–ï¼ˆä½æˆ¿ä¾›ç»™ï¼‰ï¼Œåˆç®¡å¾®è§‚å¸‚æ”¿ï¼ˆè¡—é“å«ç”Ÿï¼‰ã€‚<br><strong>å…³é”®èŒèƒ½ï¼š</strong><br>1. <strong>åŸå¸‚è§„åˆ’ä»£ç†éƒ¨</strong>ï¼šå®¡æ‰¹å¤§åŒºåŸŸè§„åˆ’ä¸Zoningå˜æ›´ã€‚<br>2. <strong>å¼€å‘å•†æœåŠ¡ä¸­å¿ƒ (Etmam)</strong>ï¼šå¼€å‘å•†çš„ç»¿è‰²é€šé“ï¼ŒåŠ é€Ÿè·¨éƒ¨é—¨å®¡æ‰¹ã€‚<br>3. <strong>Baladyå¹³å°</strong>ï¼šæ•°å­—åŒ–é—¨æˆ·ï¼Œç”³è¯·æ‰€æœ‰æ–½å·¥/æŒ–æ˜/åœŸåœ°è¯ç…§ã€‚' 
            },
            { 
                id: 'rega', 
                name: 'æˆ¿åœ°äº§æ€»å±€', 
                abbr: 'REGA', 
                type: 'authority', 
                role: 'è¡Œä¸šç›‘ç®¡ / è£åˆ¤å‘˜', 
                desc: 'è´Ÿè´£æˆ¿åœ°äº§è¡Œä¸šçš„ç«‹æ³•ã€å‘ç‰Œä¸ç›‘ç®¡ã€‚2023å¹´èµ·å¼ºåŠ›æ‰§è¡Œã€Šæˆ¿åœ°äº§ç»çºªæ³•ã€‹ã€‚', 
                details: '<strong>ç”Ÿæ€ä½ï¼š</strong>ç®¡äººï¼ˆä¸­ä»‹ï¼‰ã€ç®¡è¡Œä¸ºï¼ˆäº¤æ˜“ï¼‰ã€ç®¡æ•°æ®ã€‚è¡Œæ”¿ç‹¬ç«‹ä½†å—MOMAHéƒ¨é•¿é¢†å¯¼ã€‚<br><strong>æ ¸å¿ƒè¾–åŒºï¼š</strong><br>1. <strong>Ejar</strong>ï¼šç§Ÿèµå¼ºåˆ¶å¤‡æ¡ˆï¼Œä¸å¤‡æ¡ˆä¸å—æ³•å¾‹ä¿æŠ¤ã€‚<br>2. <strong>Wafi</strong>ï¼šæœŸæˆ¿é”€å”®ä¸èµ„é‡‘ç›‘ç®¡ï¼ˆé¢„å”®è¯ï¼‰ã€‚<br>3. <strong>Mullak</strong>ï¼šåˆ†å¥‘å¼äº§æƒä¸ä¸šä¸»åä¼š(HOA)æ³¨å†Œã€‚' 
            },
            { 
                id: 'rcrc', 
                name: 'åˆ©é›…å¾—çš‡å®¶å§”å‘˜ä¼š', 
                abbr: 'RCRC', 
                type: 'ministry', 
                role: 'æˆ˜ç•¥é¡¶å±‚ / è¶…çº§å¤§è„‘', 
                desc: 'ç›´å±å†…é˜ï¼Œç‹å‚¨æŒ‚å¸…ã€‚åœ¨åˆ©é›…å¾—ï¼Œå…¶æˆ˜ç•¥åœ°ä½é«˜äºå¸‚æ”¿ç½²ã€‚', 
                details: '<strong>ç”Ÿæ€ä½ï¼š</strong>åˆ©é›…å¾—çœŸæ­£çš„æˆ˜ç•¥åˆ¶å®šè€…ï¼ŒæœåŠ¡äºâ€œ2030æ„¿æ™¯â€ã€‚<br><strong>èŒèƒ½ï¼š</strong>è´Ÿè´£åˆ©é›…å¾—å¤§éƒ½å¸‚åœˆæ€»ä½“è§„åˆ’ï¼ˆå¦‚Metro, Riyadh Greenï¼‰ã€‚æˆ‘ä»¬çš„é¡¹ç›®è§„åˆ’å¿…é¡»ç¬¦åˆå…¶ã€Šåˆ©é›…å¾—2030æˆ˜ç•¥ã€‹ã€‚' 
            },
            { 
                id: 'amanah', 
                name: 'åˆ©é›…å¾—å¸‚æ”¿ç½²', 
                abbr: 'Amanah', 
                type: 'execution', 
                role: 'åœ°æ–¹æ‰§è¡Œ / åœ°æ–¹è¯¸ä¾¯', 
                desc: 'å‚ç›´éš¶å±äºMOMAHï¼Œæ‹¥æœ‰æå¤§çš„åœ°æ–¹è‡ªç”±è£é‡æƒã€‚', 
                details: '<strong>ç”Ÿæ€ä½ï¼š</strong>æˆ˜ç•¥å¬RCRCï¼Œæ”¿ç­–å¬MOMAHï¼Œå…·ä½“è½åœ°Amanahè¯´äº†ç®—ã€‚<br><strong>èŒèƒ½ï¼š</strong><br>1. <strong>å‘è¯</strong>ï¼šç›–ç« ã€Šå»ºç­‘æ–½å·¥è®¸å¯è¯ã€‹å’Œã€Šå®Œå·¥è¯ã€‹ã€‚<br>2. <strong>æ‰§æ³•</strong>ï¼šè´Ÿè´£ç°åœºæ£€æŸ¥ã€å«ç”Ÿåˆè§„ã€è¿å»ºç½šæ¬¾ã€‚' 
            },
            { 
                id: 'nhc', 
                name: 'å›½å®¶ä½æˆ¿å…¬å¸', 
                abbr: 'NHC', 
                type: 'partner', 
                role: 'å›½ä¼åœ°ä¸» / æˆ¿äº§ç•Œé˜¿ç¾', 
                desc: 'MOMAHçš„æŠ•èµ„è‡‚è†€ï¼Œæ²™ç‰¹æœ€å¤§çš„ä½å®…ç”¨åœ°æŒæœ‰è€…ã€‚', 
                details: '<strong>ç”Ÿæ€ä½ï¼š</strong>æ—¢æ˜¯ç›‘ç®¡æ–¹ï¼ˆæ ‡å‡†åˆ¶å®šï¼‰ï¼Œåˆæ˜¯æœ€å¤§åˆä½œä¼™ä¼´ã€‚<br><strong>åˆä½œä»·å€¼ï¼š</strong><br>1. <strong>æ‹¿åœ°</strong>ï¼šæŒæ¡å¤§é‡æ”¿åºœåˆ’æ‹¨åœŸåœ°ï¼Œå¯ä½œä¸ºSub-developeråˆä½œå¼€å‘ã€‚<br>2. <strong>é”€å”®</strong>ï¼šæ‹¥æœ‰Sakaniæ•°æ®åº“ï¼Œç›´æ¥å¯¹æ¥æ”¿åºœè¡¥è´´è´­æˆ¿å®¢ç¾¤ã€‚' 
            },
            { 
                id: 'misa', 
                name: 'æŠ•èµ„éƒ¨', 
                abbr: 'MISA', 
                type: 'ministry', 
                role: 'å¤–èµ„å‡†å…¥ / æ‹›å•†å±€', 
                desc: 'è´Ÿè´£å‘æ”¾ã€ŠæŠ•èµ„è®¸å¯è¯ã€‹(MISA License)ï¼Œå¤–èµ„ç»è¥çš„â€œèº«ä»½è¯â€ã€‚', 
                details: '<strong>ç”Ÿæ€ä½ï¼š</strong>å¤–èµ„ä¼ä¸šçš„ä¿æŠ¤ä¼å’Œè·¨éƒ¨é—¨åè°ƒäººã€‚<br><strong>èŒèƒ½ï¼š</strong>æ ¸å‘æŠ•èµ„è®¸å¯ï¼Œå‰èº«ä¸ºSAGIAã€‚é‡åˆ°è·¨éƒ¨é—¨æ¨è¯¿æ—¶ï¼ŒMISAæ˜¯æœ€é‡è¦çš„æ±‚åŠ©å¯¹è±¡ã€‚' 
            },
            { 
                id: 'mc', 
                name: 'å•†åŠ¡éƒ¨', 
                abbr: 'MC', 
                type: 'ministry', 
                role: 'å•†ä¸šæ³¨å†Œ / å·¥å•†å±€', 
                desc: 'è´Ÿè´£å…¬å¸å•†ä¸šç™»è®°(CR)ä¸å…¬å¸æ³•æ‰§è¡Œã€‚', 
                details: '<strong>èŒèƒ½ï¼š</strong>å‘æ”¾ã€Šå•†ä¸šç™»è®°è¯ã€‹(CR)ï¼Œæ ¸å®šå…¬å¸ç±»å‹ï¼ˆå¦‚LLCï¼‰å’Œç»è¥èŒƒå›´ã€‚ç›¸å½“äºä¸­å›½çš„â€œå·¥å•†å±€ + å¸‚åœºç›‘ç£ç®¡ç†å±€â€ã€‚' 
            },
            { 
                id: 'etmam', 
                name: 'å¼€å‘å•†æœåŠ¡ä¸­å¿ƒ', 
                abbr: 'Etmam', 
                type: 'ministry', 
                role: 'ç»¿è‰²é€šé“', 
                desc: 'MOMAHä¸‹å±çš„ä¸€ç«™å¼å®¡æ‰¹ä¸­å¿ƒï¼ŒåŠ é€Ÿå¤§é¡¹ç›®æµç¨‹ã€‚', 
                details: '<strong>æ ¸å¿ƒä»·å€¼ï¼š</strong>MOMAHç”¨æ¥å€’é€¼å…¶ä»–éƒ¨é—¨æé«˜æ•ˆç‡çš„å·¥å…·ã€‚ä¸ä»…æ˜¯çª—å£ï¼Œæ›´æ˜¯è·¨éƒ¨é—¨åè°ƒå™¨ã€‚' 
            },
            { 
                id: 'balady', 
                name: 'Balady å¹³å°', 
                abbr: 'Balady', 
                type: 'platform', 
                role: 'å¸‚æ”¿è®¸å¯', 
                desc: 'MOMAHçš„æ•°å­—åŒ–é—¨æˆ·ï¼Œåœ¨çº¿ç”³è¯·æ–½å·¥è¯ã€‚', 
                details: '<strong>å¿…ç”¨å¹³å°ï¼š</strong>æ‰€æœ‰ä¸åœŸåœ°ã€å»ºè®¾ã€æŒ–æ˜ç›¸å…³çš„è®¸å¯è¯å‡åœ¨æ­¤å¹³å°å…¨æ•°å­—åŒ–ç”³è¯·ã€‚' 
            },
            { 
                id: 'ejar', 
                name: 'Ejar ç§Ÿèµç½‘', 
                abbr: 'Ejar', 
                type: 'platform', 
                role: 'ç§Ÿèµå¤‡æ¡ˆ', 
                desc: 'REGAä¸‹å±å¹³å°ï¼Œæ”¿åºœæ§åˆ¶ç§Ÿæˆ¿å¸‚åœºçš„æŠ“æ‰‹ã€‚', 
                details: '<strong>å¼ºåˆ¶æ€§ï¼š</strong>æ‰“é€šå†…æ”¿éƒ¨ç³»ç»Ÿã€‚é•¿ç§Ÿå…¬å¯“åˆåŒå¿…é¡»å¤‡æ¡ˆï¼Œå¦åˆ™å‘ç”Ÿçº çº·ä¸å—æ³•å¾‹ä¿æŠ¤ã€‚' 
            },
            { 
                id: 'wafi', 
                name: 'Wafi å§”å‘˜ä¼š', 
                abbr: 'Wafi', 
                type: 'platform', 
                role: 'æœŸæˆ¿ç›‘ç®¡', 
                desc: 'REGAä¸‹å±ï¼Œç›¸å½“äºâ€œé¢„å”®åŠâ€ã€‚', 
                details: '<strong>æ ¸å¿ƒèŒèƒ½ï¼š</strong>ç®¡ç†æœŸæˆ¿é”€å”®è®¸å¯(Off-plan license)ä¸Escrowèµ„é‡‘ç›‘ç®¡è´¦æˆ·ï¼ŒæŒæ¡å¼€å‘å•†å›æ¬¾å‘½è„‰ã€‚' 
            },
            { 
                id: 'mullak', 
                name: 'Mullak è®¡åˆ’', 
                abbr: 'Mullak', 
                type: 'platform', 
                role: 'ä¸šä¸»åä¼š', 
                desc: 'REGAä¸‹å±ï¼Œç®¡ç†åˆ†å¥‘å¼äº§æƒã€‚', 
                details: '<strong>åˆè§„è¦æ±‚ï¼š</strong>è¿è¥æ•´æ ‹ç‰©ä¸šæˆ–è¿›è¡Œåˆ†å±‚é”€å”®æ—¶ï¼Œå¿…é¡»åœ¨æ­¤æ³¨å†Œä¸šä¸»å§”å‘˜ä¼š(HOA)ä»¥ç®¡ç†ç‰©ä¸šè´¹ã€‚' 
            },
            { 
                id: 'tourism', 
                name: 'æ—…æ¸¸éƒ¨', 
                abbr: 'Tourism', 
                type: 'ministry', 
                role: 'é…’åº—å…¬å¯“ç›‘ç®¡', 
                desc: 'è´Ÿè´£æ—…æ¸¸ä½å®¿è®¾æ–½çš„æ‰§ç…§é¢å‘ä¸æ˜Ÿçº§è¯„å®šã€‚', 
                details: '<strong>å…³é”®ç•Œé™ï¼š</strong>è‹¥é•¿ç§Ÿå…¬å¯“æä¾›æ—¥ç§Ÿ/çŸ­ç§Ÿ/å‰å°æœåŠ¡ï¼Œæˆ–è¢«å®šæ€§ä¸ºâ€œæœåŠ¡å¼å…¬å¯“â€ï¼Œå¿…é¡»ç”±æ—…æ¸¸éƒ¨å‘ç‰Œï¼Œè€Œéä½æˆ¿éƒ¨ã€‚' 
            },
            { 
                id: 'civil', 
                name: 'æ°‘é˜²æ€»å±€', 
                abbr: 'Civil Defense', 
                type: 'execution', 
                role: 'æ¶ˆé˜²å®‰å…¨ / ä¸€ç¥¨å¦å†³', 
                desc: 'éš¶å±å†…æ”¿éƒ¨ï¼Œæ‹¥æœ‰å®Œå·¥éªŒæ”¶çš„ä¸€ç¥¨å¦å†³æƒã€‚', 
                details: '<strong>ä¸¥è‹›æ ‡å‡†ï¼š</strong>ä»»ä½•å…¬å¯“æ¥¼å¼€ä¸šå‰ï¼Œå¿…é¡»æ‹¿åˆ°æ°‘é˜²å±€çš„æ¶ˆé˜²è®¸å¯è¯ã€‚' 
            },
            { 
                id: 'zatca', 
                name: 'ç¨åŠ¡æµ·å…³æ€»å±€', 
                abbr: 'ZATCA', 
                type: 'authority', 
                role: 'ç¨åŠ¡å¾æ”¶ / è´¢ç¥çˆ·', 
                desc: 'è´Ÿè´£ç®¡ç†å¢å€¼ç¨(VAT)ã€æˆ¿åœ°äº§äº¤æ˜“ç¨(RETT)ã€‚', 
                details: '<strong>æ ¸å¿ƒç¨ç§ï¼š</strong><br>1. <strong>RETT</strong>ï¼šæˆ¿äº§ä¹°å–éœ€ç¼´5%äº¤æ˜“ç¨ã€‚<br>2. <strong>VAT</strong>ï¼šå•†ä¸šç§Ÿèµï¼ˆå¦‚åº•å•†ï¼‰éœ€ç¼´15%ï¼Œä½å®…ç§Ÿèµé€šå¸¸å…ç¨ã€‚' 
            },
            { 
                id: 'redf', 
                name: 'æˆ¿åœ°äº§å‘å±•åŸºé‡‘', 
                abbr: 'REDF', 
                type: 'partner', 
                role: 'é‡‘èæ”¯æŒ / èµ„é‡‘æº', 
                desc: 'å›½å®¶å‘å±•åŸºé‡‘åºåˆ—ï¼Œä¸»è¦ç»™å…¬æ°‘å‘æˆ¿è´·è¡¥è´´ã€‚', 
                details: '<strong>å¼€å‘å•†æœºä¼šï¼š</strong>å…³æ³¨å…¶ <strong>Tatweer</strong> è®¡åˆ’ï¼Œè¿™æ˜¯ä¸“é—¨ä¸ºå¼€å‘å•†æä¾›çš„è¿‡æ¡¥èèµ„æ¸ é“ã€‚' 
            }
        ];

        const lawsData = [
            { title: "æˆ¿åœ°äº§ç»çºªæ³• (Real Estate Brokerage Law)", date: "2023ç”Ÿæ•ˆ", desc: "å–ç¼”è‡ªç”±ç»çºªäººï¼Œå¼ºåˆ¶ä¸­ä»‹æŒè¯(Fal License)ã€‚è§„èŒƒä½£é‡‘ä¸Šé™ä¸ç‹¬å®¶ä»£ç†åˆåŒã€‚" },
            { title: "æˆ¿åœ°äº§å‚è‚¡/é›†èµ„æ³• (Real Estate Contributions Law)", date: "2023ç”Ÿæ•ˆ", desc: "è§„èŒƒå¤šæ–¹é›†èµ„ã€ä¼—ç­¹å¼€å‘æˆ¿åœ°äº§çš„è¡Œä¸ºã€‚ç”±CMA(èµ„æœ¬å¸‚åœºå±€)ä¸REGAåŒé‡ç›‘ç®¡ã€‚" },
            { title: "æ°‘äº‹äº¤æ˜“æ³• (Civil Transactions Law)", date: "2023ç”Ÿæ•ˆ", desc: "æ²™ç‰¹é¦–éƒ¨æ°‘æ³•å…¸ã€‚ç¡®ç«‹äº†åˆåŒç¥åœ£æ€§ï¼Œå‡å°‘äº†æ³•å®˜åŸºäºä¼Šæ–¯å…°æ•™æ³•çš„è‡ªç”±è£é‡æƒï¼Œæå¤§å¢å¼ºå•†ä¸šç¡®å®šæ€§ã€‚" },
            { title: "å¤–å•†æŠ•èµ„æ³• (Foreign Investment Law)", date: "åŸºç¡€æ³•å¾‹", desc: "ç¡®ç«‹äº†å¤–èµ„ä¸å†…èµ„å¹³ç­‰å¾…é‡åŸåˆ™ã€‚è§„å®šäº†MISAå‘ç‰Œåˆ¶åº¦åŠå¤–èµ„è´Ÿé¢æ¸…å•ã€‚" },
            { title: "éæ²™ç‰¹äººæˆ¿åœ°äº§æ‰€æœ‰æƒä¸æŠ•èµ„æ³•", date: "ç°è¡Œ/ä¿®è®¢ä¸­", desc: "ç›®å‰éæ²™ç‰¹äººåœ¨åˆ©é›…å¾—ä¹°æˆ¿ä»å—é™(éœ€å®¡æ‰¹)ã€‚æ–°æ³•è‰æ¡ˆæ—¨åœ¨è¿›ä¸€æ­¥æ”¾å¼€é™åˆ¶ï¼Œä½†å°šæœªæ­£å¼è½åœ°ã€‚" },
            { title: "æˆ¿åœ°äº§äº¤æ˜“ç¨æ³• (RETT Executive Regulations)", date: "2020ç”Ÿæ•ˆ", desc: "è§„å®šæˆ¿åœ°äº§å¤„ç½®å…å¾15%å¢å€¼ç¨ï¼Œæ”¹ä¸ºå¾æ”¶5%çš„æˆ¿åœ°äº§äº¤æ˜“ç¨(RETT)ï¼Œé™ä½äº¤æ˜“æˆæœ¬ã€‚" },
            { title: "æ°‘é˜²ä¸æ¶ˆé˜²å®‰å…¨æ¡ä¾‹", date: "å¼ºåˆ¶æ ‡å‡†", desc: "å†…æ”¿éƒ¨é¢å¸ƒçš„ä¸¥æ ¼å»ºç­‘æ¶ˆé˜²æ ‡å‡†ã€‚æ˜¯è·å–å®Œå·¥è¯çš„å‰ç½®æ¡ä»¶ï¼Œæ‹¥æœ‰æœ€é«˜æ‰§æ³•æƒã€‚" }
        ];

        const workflowSteps = [
            { title: "1. å¸‚åœºå‡†å…¥", desc: "è·å–ç»è¥èº«ä»½", tasks: [{dept:"MISA", txt:"ç”³è¯·æŠ•èµ„è®¸å¯"}, {dept:"MC", txt:"å•†ä¸šç™»è®° (CR)"}, {dept:"ZATCA", txt:"ç¨åŠ¡ç™»è®°"}] },
            { title: "2. æ‹¿åœ°è§„åˆ’", desc: "é”å®šé¡¹ç›®ç”¨åœ°", tasks: [{dept:"NHC", txt:"æ´½è°ˆåœŸåœ°åˆä½œ"}, {dept:"RCRC", txt:"2030åˆè§„å®¡æŸ¥"}, {dept:"MOMAH", txt:"Zoningç”¨é€”å˜æ›´"}] },
            { title: "3. å»ºè®¾å®¡æ‰¹", desc: "ä»å›¾çº¸åˆ°åŠ¨å·¥", tasks: [{dept:"Etmam", txt:"ç»¼åˆå®¡æ‰¹é€šé“"}, {dept:"Balady", txt:"ç”³è¯·æ–½å·¥è®¸å¯è¯"}, {dept:"Wafi", txt:"æœŸæˆ¿é”€å”®è®¸å¯"}] },
            { title: "4. éªŒæ”¶äº¤ä»˜", desc: "åˆè§„è½¬ä¸ºèµ„äº§", tasks: [{dept:"æ°‘é˜²", txt:"æ¶ˆé˜²éªŒæ”¶ (æ ¸å¿ƒ)"}, {dept:"Amanah", txt:"å®Œå·¥è¯ç”³è¯·"}, {dept:"Mullak", txt:"ä¸šä¸»åä¼šæ³¨å†Œ"}] },
            { title: "5. è¿è¥ç®¡ç†", desc: "é•¿æœŸæ”¶ç›Š", tasks: [{dept:"Ejar", txt:"ç§ŸèµåˆåŒå¤‡æ¡ˆ"}, {dept:"Tourism", txt:"æœåŠ¡å…¬å¯“æ‰§ç…§"}, {dept:"ZATCA", txt:"ç¨åŠ¡ç”³æŠ¥"}] }
        ];

        // --- RENDER FUNCTIONS ---

        function renderDirectory(filterType = 'all', searchVal = '') {
            const grid = document.getElementById('directory-grid');
            grid.innerHTML = '';
            
            const filtered = agencyData.filter(d => {
                const matchType = filterType === 'all' || d.type === filterType;
                const matchSearch = d.name.includes(searchVal) || d.abbr.toLowerCase().includes(searchVal.toLowerCase());
                return matchType && matchSearch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-3 text-center py-10 text-gray-400">æœªæ‰¾åˆ°åŒ¹é…çš„æœºæ„</div>`;
                return;
            }

            filtered.forEach(d => {
                let colorClass = 'border-l-4 border-sand-200';
                let tagClass = 'bg-sand-100 text-slate-600';
                
                if(d.type === 'ministry') { colorClass = 'border-l-4 border-saudi-green'; tagClass = 'bg-saudi-green text-white'; }
                if(d.type === 'authority') { colorClass = 'border-l-4 border-gold-accent'; tagClass = 'bg-gold-accent text-white'; }
                if(d.type === 'execution') { colorClass = 'border-l-4 border-slate-500'; tagClass = 'bg-slate-500 text-white'; }
                if(d.type === 'partner') { colorClass = 'border-l-4 border-saudi-green-light'; tagClass = 'bg-saudi-green-light text-white'; }
                if(d.type === 'platform') { colorClass = 'border-l-4 border-sand-200'; tagClass = 'bg-sand-200 text-slate-800'; }

                grid.innerHTML += `
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-sand-100 hover:shadow-md transition-all ${colorClass} group flex flex-col h-full">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-bold text-xl text-slate-800">${d.abbr}</h3>
                            <span class="text-[10px] px-2 py-1 rounded ${tagClass} font-bold">${d.role}</span>
                        </div>
                        <h4 class="text-sm font-bold text-gray-700 mb-2">${d.name}</h4>
                        <p class="text-xs text-gray-500 mb-4 h-10 overflow-hidden leading-relaxed">${d.desc}</p>
                        
                        <div class="mt-auto">
                            <details class="text-xs text-gray-600 border-t border-sand-100 pt-2 cursor-pointer group/details">
                                <summary class="list-none font-bold text-saudi-green-light flex items-center gap-1 hover:underline select-none">
                                    <span>å±•å¼€è¯¦ç»†èŒèƒ½</span>
                                    <svg class="w-3 h-3 transition-transform group-open/details:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </summary>
                                <p class="mt-2 p-2 bg-sand-50 rounded text-gray-700 border border-sand-100 leading-relaxed">${d.details}</p>
                            </details>
                        </div>
                    </div>
                `;
            });
        }

        function renderWorkflow(activeIndex = 0) {
            const stepsDiv = document.getElementById('workflow-steps-container');
            const contentDiv = document.getElementById('workflow-content');
            
            stepsDiv.innerHTML = workflowSteps.map((s, i) => `
                <button onclick="renderWorkflow(${i})" class="w-full text-left px-5 py-4 rounded-xl border transition-all flex items-center justify-between group ${i===activeIndex ? 'bg-white border-gold-accent shadow-md ring-1 ring-gold-accent z-10 relative' : 'bg-white border-sand-200 hover:bg-sand-50 text-gray-500 hover:border-gold-accent/50'}">
                    <div>
                        <div class="font-bold text-sm ${i===activeIndex ? 'text-saudi-green' : 'group-hover:text-saudi-green transition-colors'}">${s.title}</div>
                        <div class="text-xs mt-1 ${i===activeIndex ? 'text-gold-accent' : 'text-gray-400'}">${s.desc}</div>
                    </div>
                    ${i===activeIndex ? '<svg class="w-5 h-5 text-gold-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>' : ''}
                </button>
            `).join('');

            const step = workflowSteps[activeIndex];
            contentDiv.innerHTML = `
                <div class="relative z-10 animate-fade-in">
                    <div class="text-xs font-bold text-gold-accent uppercase tracking-widest mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-gold-accent animate-pulse"></span>
                        å½“å‰é˜¶æ®µ
                    </div>
                    <h3 class="text-3xl font-bold text-saudi-green mb-1">${step.title}</h3>
                    <p class="text-gray-500 mb-8 font-medium">${step.desc}</p>
                    
                    <div class="space-y-4">
                        ${step.tasks.map((t, idx) => `
                            <div class="flex items-center p-4 bg-sand-50 rounded-lg border border-sand-200 hover:border-saudi-green/30 transition-colors" style="animation: fadeIn 0.3s ease-out both; animation-delay: ${idx * 0.1}s">
                                <span class="px-2 py-1 rounded bg-saudi-green text-white text-xs font-bold mr-4 min-w-[70px] text-center shadow-sm">${t.dept}</span>
                                <span class="text-sm text-gray-700 font-medium">${t.txt}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="absolute -bottom-16 -right-12 text-[200px] font-bold text-sand-100/50 select-none pointer-events-none">${activeIndex+1}</div>
            `;
        }

        function renderLaws() {
            const container = document.getElementById('legal-list');
            container.innerHTML = lawsData.map(law => `
                <div class="bg-white border border-sand-200 rounded-lg overflow-hidden hover:shadow-md transition-all group">
                    <details class="group">
                        <summary class="flex justify-between items-center p-5 cursor-pointer list-none bg-white hover:bg-sand-50 transition-colors">
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-800 text-lg group-open:text-saudi-green transition-colors flex items-center gap-3">
                                    ${law.title}
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-sand-100 text-saudi-green border border-saudi-green/10">${law.date}</span>
                                </h4>
                            </div>
                            <div class="bg-sand-100 rounded-full p-1 ml-4 group-open:bg-saudi-green group-open:text-white transition-colors">
                                <svg class="w-5 h-5 text-gray-500 group-open:text-white transform group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </summary>
                        <div class="p-6 border-t border-sand-100 bg-sand-50 text-sm text-gray-600 leading-relaxed">
                            <div class="flex gap-3">
                                <div class="w-1 bg-gold-accent rounded-full shrink-0"></div>
                                <div>
                                    <span class="font-bold text-saudi-green block mb-1">æ ¸å¿ƒå†…å®¹ä¸å½±å“ï¼š</span>
                                    ${law.desc}
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
            `).join('');
        }

        function initFilters() {
            const container = document.getElementById('filter-container');
            const filters = [
                {id: 'all', txt: 'å…¨éƒ¨'},
                {id: 'ministry', txt: 'éƒ¨å§”'},
                {id: 'authority', txt: 'æ€»å±€'},
                {id: 'execution', txt: 'æ‰§è¡Œ'},
                {id: 'platform', txt: 'å¹³å°'},
                {id: 'partner', txt: 'å›½ä¼'}
            ];
            container.innerHTML = filters.map(f => `
                <button onclick="applyFilter('${f.id}')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-bold border border-sand-200 hover:bg-sand-100 text-slate-500 transition-all hover:shadow-sm" data-id="${f.id}">
                    ${f.txt}
                </button>
            `).join('');
            // Set All active
            applyFilter('all');
        }

        function applyFilter(type) {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = 'filter-btn px-4 py-1.5 rounded-full text-xs font-bold border border-sand-200 hover:bg-sand-100 text-slate-500 transition-all hover:shadow-sm';
            });
            const activeBtn = document.querySelector(`[data-id="${type}"]`);
            if(activeBtn) {
                activeBtn.className = 'filter-btn px-4 py-1.5 rounded-full text-xs font-bold bg-saudi-green text-white border-transparent shadow-md transform scale-105';
            }
            
            renderDirectory(type, document.getElementById('searchInput').value);
        }

        // --- Navigation Logic ---
        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('block');
            });
            const target = document.getElementById(sectionId);
            target.classList.remove('hidden');
            target.classList.add('block');

            document.querySelectorAll('.nav-item').forEach(el => {
                if(el.dataset.target === sectionId) {
                    el.classList.add('bg-white/10', 'text-white', 'shadow-inner');
                    el.classList.remove('opacity-80');
                } else {
                    el.classList.remove('bg-white/10', 'text-white', 'shadow-inner');
                    el.classList.add('opacity-80');
                }
            });

            // Mobile menu close
            if(window.innerWidth < 1024) {
                 document.getElementById('sidebar').classList.add('-translate-x-full');
                 document.getElementById('sidebar-overlay').classList.add('hidden');
            }
        }

        // --- Gemini AI Logic (Adapted for Knowledge Base) ---
        const apiKey = ""; 
        
        const reportContext = `
            çŸ¥è¯†åº“å†…å®¹æ‘˜è¦ï¼š
            1. æ ¸å¿ƒæœºæ„ï¼š
            - MOMAH (å¸‚æ”¿ä¸ä½æˆ¿éƒ¨): æˆ¿åœ°äº§æœ€é«˜ä¸»ç®¡éƒ¨é—¨ï¼Œå®šæ”¿ç­–ã€‚
            - REGA (æˆ¿åœ°äº§æ€»å±€): ç›‘ç®¡è€…ï¼Œè´Ÿè´£Fal(ä¸­ä»‹), Ejar(ç§Ÿèµ), Wafi(æœŸæˆ¿)å¹³å°ã€‚
            - RCRC (åˆ©é›…å¾—çš‡å®¶å§”å‘˜ä¼š): æˆ˜ç•¥é¡¶å±‚ï¼Œè´Ÿè´£2030æ„¿æ™¯ã€‚
            - Amanah (å¸‚æ”¿ç½²): åœ°æ–¹æ‰§è¡Œå±‚ï¼Œè´Ÿè´£å‘è¯ã€æ‰§æ³•ã€‚
            - NHC (å›½å®¶ä½æˆ¿å…¬å¸): å›½ä¼åœ°ä¸»ï¼Œæœ€å¤§åœŸåœ°æŒæœ‰è€…ã€‚
            - MISA (æŠ•èµ„éƒ¨): å‘å¤–èµ„ç‰Œç…§ã€‚
            
            2. ä¸šåŠ¡æµç¨‹ï¼š
            - å¸‚åœºå‡†å…¥: MISAè®¸å¯ -> MCå•†ä¸šç™»è®° -> ZATCAç¨åŠ¡ã€‚
            - æ‹¿åœ°: NHCåˆä½œ -> RCRCå®¡æŸ¥ -> MOMAHå˜æ€§ã€‚
            - å»ºè®¾: Etmamå®¡æ‰¹ -> Baladyæ–½å·¥è¯ -> Wafié”€å”®è¯ã€‚
            - äº¤ä»˜: æ°‘é˜²æ¶ˆé˜²éªŒæ”¶ -> Amanahå®Œå·¥è¯ -> Mullakä¸šå§”ä¼šã€‚
            
            3. æ³•å¾‹æ³•è§„ï¼š
            - æˆ¿åœ°äº§ç»çºªæ³•: å¼ºåˆ¶æŒè¯ã€‚
            - æ°‘äº‹äº¤æ˜“æ³•: åˆåŒç¥åœ£æ€§ã€‚
            - ç§Ÿé‡‘å†»ç»“: åˆ©é›…å¾—æ–°æ”¿ï¼Œå†»ç»“5å¹´ã€‚
        `;

        async function callGemini(userQuery) {
            // Simulation Mode for when API Key is missing in this static file
            if (!apiKey) {
                await new Promise(r => setTimeout(r, 1500)); // Simulate network delay
                
                // Simple keyword matching for demo purposes
                if (userQuery.includes("REGA") || userQuery.includes("MOMAH")) {
                    return "<strong>MOMAH (å¸‚æ”¿ä¸ä½æˆ¿éƒ¨)</strong> æ˜¯åˆ¶å®šæ”¿ç­–çš„æœ€é«˜éƒ¨é—¨ï¼Œç›¸å½“äºæˆ‘ä»¬çš„â€œå¨˜å®¶â€ã€‚\n\nè€Œ <strong>REGA (æˆ¿åœ°äº§æ€»å±€)</strong> æ˜¯ç›‘ç®¡æœºæ„ï¼Œè´Ÿè´£å…·ä½“çš„è¡Œä¸šç›‘ç®¡ï¼Œæ¯”å¦‚ç»™ä¸­ä»‹å‘ç‰Œã€ç®¡ç†ç§Ÿèµå¹³å°ã€‚ç®€å•æ¥è¯´ï¼ŒMOMAHæ˜¯å®šè§„çŸ©çš„ï¼ŒREGAæ˜¯ç›¯ç€å¤§å®¶å®ˆè§„çŸ©çš„ã€‚";
                } else if (userQuery.includes("æµç¨‹") || userQuery.includes("æ‹¿åœ°")) {
                    return "æ‹¿åœ°å¼€å‘çš„æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š\n1. **å¸‚åœºå‡†å…¥**ï¼šå…ˆæå®šMISAæŠ•èµ„è®¸å¯ã€‚\n2. **æ‹¿åœ°**ï¼šæ‰¾NHCåˆä½œæ‹¿åœ°ï¼Œæˆ–è€…è´­ä¹°ç§åœ°ï¼Œéœ€è¦è¿‡RCRCçš„æˆ˜ç•¥å®¡æŸ¥ã€‚\n3. **å»ºè®¾**ï¼šé€šè¿‡Etmamèµ°ç»¿è‰²é€šé“ï¼Œåœ¨Baladyä¸Šæ‹¿æ–½å·¥è¯ã€‚\n4. **é”€å”®**ï¼šå¦‚æœæ˜¯æœŸæˆ¿ï¼Œå¿…é¡»æ‹¿åˆ°Wafiè®¸å¯ã€‚";
                } else if (userQuery.includes("å¤–èµ„") || userQuery.includes("MISA")) {
                    return "å¤–å›½æŠ•èµ„è€…è¿›å…¥æ²™ç‰¹çš„ç¬¬ä¸€æ­¥å¿…é¡»æ˜¯è·å¾— <strong>MISA (æŠ•èµ„éƒ¨)</strong> çš„è®¸å¯è¯ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨æ²™ç‰¹åˆæ³•ç»è¥çš„â€œèº«ä»½è¯â€ã€‚è·å¾—è®¸å¯åï¼Œæ‰èƒ½å»å•†åŠ¡éƒ¨(MC)æ³¨å†Œå…¬å¸ï¼Œå»ç¨åŠ¡å±€(ZATCA)ç™»è®°ç¨åŠ¡ã€‚";
                } else {
                    return "è¿™æ˜¯ä¸€ä¸ªå…³äºSmart Oasiså†…éƒ¨çŸ¥è¯†åº“çš„å¥½é—®é¢˜ã€‚æ ¹æ®æˆ‘ä»¬çš„èµ„æ–™ï¼Œæ²™ç‰¹æˆ¿åœ°äº§å¸‚åœºå‘ˆç°æ‰å¹³åŒ–ç®¡ç†ç‰¹å¾ã€‚å¦‚æœæ‚¨éœ€è¦å…³äºå…·ä½“æœºæ„ï¼ˆå¦‚NHC, Amanahï¼‰çš„ç»†èŠ‚ï¼Œè¯·å…·ä½“è¯¢é—®ã€‚";
                }
            }

            const systemPrompt = `
                ä½ æ˜¯ä¸€ä½æ²™ç‰¹æˆ¿åœ°äº§å¸‚åœºä¸“å®¶ï¼Œä¹Ÿæ˜¯Smart Oasiså…¬å¸çš„å†…éƒ¨çŸ¥è¯†åŠ©æ‰‹ã€‚
                åŸºäºä»¥ä¸‹çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
                ä¿æŒå›ç­”ä¸“ä¸šã€ç®€æ´ã€æœ‰æ¡ç†ã€‚
                
                çŸ¥è¯†åº“å†…å®¹ï¼š
                ${reportContext}
            `;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error('API Error');

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return "æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨æ— æ³•è¿æ¥åˆ°çŸ¥è¯†åº“æœåŠ¡å™¨ã€‚";
            }
        }

        // --- Chat UI Logic ---
        function toggleAIChat() {
            const panel = document.getElementById('ai-chat-panel');
            const overlay = document.getElementById('chat-overlay');
            
            if (panel.classList.contains('translate-x-full')) {
                panel.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                document.getElementById('user-input').focus();
            } else {
                panel.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        function appendMessage(text, sender) {
            const chatBox = document.getElementById('chat-messages');
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender} animate-fade-in`;
            
            if (sender === 'ai') {
                let formattedText = text.replace(/\n/g, '<br>');
                formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong class="text-saudi-green">$1</strong>');
                bubble.innerHTML = formattedText;
            } else {
                bubble.textContent = text;
            }
            
            chatBox.appendChild(bubble);
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }

        function appendLoading() {
            const chatBox = document.getElementById('chat-messages');
            const bubble = document.createElement('div');
            bubble.id = 'loading-bubble';
            bubble.className = 'chat-bubble ai';
            bubble.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            chatBox.appendChild(bubble);
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }

        function removeLoading() {
            const bubble = document.getElementById('loading-bubble');
            if (bubble) bubble.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            input.value = '';
            appendLoading();

            const response = await callGemini(text);

            removeLoading();
            appendMessage(response, 'ai');
        }
        
        function askQuestion(question) {
            const input = document.getElementById('user-input');
            input.value = question;
            sendMessage();
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        document.getElementById('menu-btn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('-translate-x-full');
            document.getElementById('sidebar-overlay').classList.remove('hidden');
        });

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderWorkflow();
            initFilters();
            renderDirectory();
            renderLaws();
            
            document.getElementById('searchInput').addEventListener('input', (e) => renderDirectory('all', e.target.value));
            
            // Set initial active tab
            showSection('dashboard');
        });

    </script>
</body>
</html>


