<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Oasis | Saudi GR Strategy System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Noto Sans SC & Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config for Custom Palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '"Noto Sans SC"', 'sans-serif'],
                    },
                    colors: {
                        'sand-50': '#f9f7f2',
                        'sand-100': '#f0eadd',
                        'sand-200': '#e2d6c0',
                        'saudi-green': '#1e5f44',
                        'saudi-green-light': '#2d8a63',
                        'gold-accent': '#c5a065',
                        'slate-dark': '#334155',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in-right': 'slideInRight 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    },
                    boxShadow: {
                        'card': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'floating': '0 10px 40px -10px rgba(30, 95, 68, 0.15)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f0eadd; }
        ::-webkit-scrollbar-thumb { background: #c5a065; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #1e5f44; }

        /* Transitions */
        .transition-all-300 { transition: all 0.3s ease-in-out; }

        /* Ecosystem Tree Styles */
        .eco-node {
            position: relative;
            z-index: 10;
            transition: all 0.3s ease;
        }
        .eco-node:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .connector-v {
            width: 2px;
            background-color: #e2d6c0;
            margin: 0 auto;
            position: relative;
        }
        
        /* Accordion Animation */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: sweep .3s ease-in-out; }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-10px)}
            100%  {opacity: 1; transform: translateY(0)}
        }

        /* AI Chat Bubble Styles */
        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
        }
        .chat-bubble.user {
            background-color: #1e5f44;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .chat-bubble.ai {
            background-color: #ffffff;
            color: #334155;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            border: 1px solid #e2d6c0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .typing-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #888;
            animation: typing 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-sand-50 text-slate-dark font-sans antialiased overflow-hidden h-screen flex flex-col lg:flex-row">

    <!-- Mobile Nav Toggle -->
    <div class="lg:hidden bg-saudi-green text-white p-4 flex justify-between items-center shadow-md fixed w-full z-50 top-0 h-16">
        <div class="flex items-center gap-2">
            <div class="h-6 w-6 bg-white/10 rounded flex items-center justify-center text-xs font-bold text-gold-accent border border-gold-accent/30">S</div>
            <h1 class="text-lg font-bold">Smart Oasis</h1>
        </div>
        <div class="flex items-center gap-4">
             <button onclick="switchLanguage()" class="text-xs font-bold bg-white/20 px-2 py-1 rounded hover:bg-white/30 transition">EN/CN</button>
            <button id="menu-btn" class="text-white focus:outline-none text-2xl">â˜°</button>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="bg-saudi-green text-white w-64 space-y-6 py-4 px-2 absolute inset-y-0 left-0 transform -translate-x-full lg:relative lg:translate-x-0 transition duration-300 ease-in-out z-40 h-full flex flex-col pt-20 lg:pt-6 shadow-2xl lg:shadow-none border-r border-saudi-green-light/30">
        <div class="px-4 mb-6 hidden lg:block">
            <div class="flex items-center gap-3 mb-2">
                <div class="h-10 w-10 bg-white/10 rounded-lg text-gold-accent flex items-center justify-center font-bold text-xl shadow-lg border border-gold-accent/40 backdrop-blur-sm">S</div>
                <div>
                    <h2 class="text-xl font-bold tracking-wide leading-none">Smart Oasis</h2>
                    <p class="text-[10px] text-sand-200 mt-1 uppercase tracking-wider opacity-80" data-i18n="kb_subtitle">Knowledge Base</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 space-y-1 overflow-y-auto px-2">
            <a href="#" onclick="showSection('dashboard')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white flex items-center gap-3 mb-1 opacity-80" data-target="dashboard">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                <span data-i18n="nav_dashboard">ç”Ÿæ€å…¨æ™¯å›¾</span>
            </a>
            <a href="#" onclick="showSection('workflow')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white flex items-center gap-3 mb-1 opacity-80" data-target="workflow">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                <span data-i18n="nav_workflow">ä¸šåŠ¡æµç¨‹</span>
            </a>
            <a href="#" onclick="showSection('directory')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white bg-white/10 font-bold text-white shadow-inner flex items-center gap-3 mb-1" data-target="directory">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                <span data-i18n="nav_directory">æœºæ„ç™¾ç§‘å…¨ä¹¦</span>
            </a>
            <a href="#" onclick="showSection('legal')" class="nav-item block py-3 px-4 rounded-lg transition duration-200 hover:bg-white/10 hover:text-white flex items-center gap-3 mb-1 opacity-80" data-target="legal">
                <svg class="w-5 h-5 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                <span data-i18n="nav_legal">æ³•å¾‹æ³•è§„åº“</span>
            </a>
        </nav>

        <!-- Language & AI Buttons -->
        <div class="px-4 pb-6 mt-auto space-y-3">
             <button onclick="switchLanguage()" class="hidden lg:block w-full py-2 px-4 bg-white/10 hover:bg-white/20 text-white rounded-lg transition text-xs font-bold border border-white/5 uppercase tracking-wider text-center">
                CN / EN Switch
            </button>

            <button onclick="toggleAIChat()" class="w-full py-3 px-4 bg-gradient-to-r from-gold-accent to-yellow-700 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all flex items-center justify-center space-x-2 font-bold group border border-white/10">
                <span class="text-xl group-hover:animate-pulse">âœ¨</span>
                <span data-i18n="ai_assistant_btn">æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹</span>
            </button>
        </div>

        <div class="p-4 text-[10px] text-sand-200/60 border-t border-white/10">
            <p>Version 2.1 | Dec 2025</p>
            <p class="font-mono mt-1">INTERNAL USE ONLY</p>
        </div>
    </aside>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebar-overlay" onclick="document.getElementById('sidebar').classList.add('-translate-x-full'); document.getElementById('sidebar-overlay').classList.add('hidden');" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden backdrop-blur-sm"></div>

    <!-- Main Content -->
    <main class="flex-1 w-full lg:ml-0 transition-all-300 h-full flex flex-col relative bg-sand-50">
        <div class="flex-1 overflow-y-auto p-4 lg:p-10 scroll-smooth">
            <div class="max-w-7xl mx-auto space-y-8 pb-12 pt-16 lg:pt-0">
                
                <!-- VIEW 1: ECOSYSTEM PANORAMA -->
                <div id="dashboard" class="section-content hidden animate-fade-in">
                    <!-- Header -->
                    <header class="mb-8 border-b-2 border-gold-accent pb-6">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-end gap-4">
                            <div>
                                <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green tracking-tight" data-i18n="dash_title">æ²™ç‰¹æˆ¿åœ°äº§æƒåŠ›ç”Ÿæ€å…¨æ™¯</h1>
                                <p class="mt-2 text-slate-600" data-i18n="dash_subtitle">
                                    ç†æ¸…æ²™ç‰¹æ”¿åºœæœºæ„çš„éš¶å±ã€ç›‘ç®¡ä¸æ‰§è¡Œå…³ç³»ï¼Œè¯†åˆ«â€œè£åˆ¤å‘˜â€ä¸â€œè¿åŠ¨å‘˜â€ã€‚
                                </p>
                            </div>
                            <div class="text-right hidden md:block">
                                <span class="bg-saudi-green/10 text-saudi-green px-3 py-1 rounded-full text-xs font-bold">Updated: 2025.12</span>
                            </div>
                        </div>
                    </header>

                    <!-- Admin System Comparison (Rendered via JS now for i18n) -->
                    <div id="comparison-container" class="bg-white rounded-xl border border-sand-200 shadow-card overflow-hidden mb-10 group hover:shadow-md transition-shadow">
                        <!-- Content Injected by JS -->
                    </div>

                    <!-- Vertical Ecosystem Tree -->
                    <div class="bg-white rounded-xl p-8 lg:p-12 border border-sand-200 shadow-card flex justify-center overflow-x-auto relative min-h-[600px]">
                        <!-- Background Grid Pattern -->
                        <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(#1e5f44 1px, transparent 1px); background-size: 20px 20px;"></div>

                        <div class="w-full max-w-5xl flex flex-col items-center gap-8 min-w-[700px] relative z-10">
                            
                            <!-- Level 1: King -->
                            <div class="eco-node bg-saudi-green text-white px-10 py-4 rounded-lg shadow-floating text-center min-w-[240px] border-b-4 border-gold-accent">
                                <div class="font-bold text-xl tracking-wide" data-i18n="tree_king">å›½ç‹ / å†…é˜</div>
                                <div class="text-[10px] opacity-80 uppercase tracking-widest mt-1">Council of Ministers</div>
                            </div>

                            <!-- Connector -->
                            <div class="h-10 connector-v"></div>

                            <!-- Level 2: Top Strategies (Split) -->
                            <div class="grid grid-cols-2 gap-16 w-full relative">
                                <!-- Horizontal Connector for Level 2 -->
                                <div class="absolute top-0 left-1/4 right-1/4 h-0.5 bg-sand-200 -mt-10 hidden md:block rounded-full"></div> 
                                <div class="absolute top-0 left-1/4 h-10 w-0.5 bg-sand-200 -mt-10 hidden md:block"></div>
                                <div class="absolute top-0 right-1/4 h-10 w-0.5 bg-sand-200 -mt-10 hidden md:block"></div>

                                <!-- Left: MOMAH System (Complex) -->
                                <div class="flex flex-col items-center">
                                    <div class="eco-node bg-sand-50 border-2 border-saudi-green-light/20 p-5 rounded-lg shadow-sm text-center w-full max-w-[320px]">
                                        <div class="font-bold text-saudi-green text-lg">MOMAH</div>
                                        <div class="text-xs text-saudi-green-light mt-1 font-bold bg-white/50 inline-block px-2 py-0.5 rounded" data-i18n="tree_momah_role">æˆ¿åœ°äº§æœ€é«˜ä¸»ç®¡éƒ¨é—¨</div>
                                    </div>
                                    
                                    <div class="h-8 connector-v"></div>

                                    <!-- MOMAH Sub-entities Grid -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full relative">
                                        <!-- Horizontal Line for MOMAH children -->
                                        <div class="absolute top-0 left-6 right-6 h-0.5 bg-sand-200 -mt-8 hidden md:block"></div>
                                        <div class="absolute top-0 left-1/2 h-8 w-0.5 bg-sand-200 -mt-8 hidden md:block"></div>
                                        <div class="absolute top-0 left-6 h-8 w-0.5 bg-sand-200 -mt-8 hidden md:block"></div>
                                        <div class="absolute top-0 right-6 h-8 w-0.5 bg-sand-200 -mt-8 hidden md:block"></div>

                                        <!-- REGA (Regulator) -->
                                        <div class="flex flex-col items-center">
                                            <div class="eco-node bg-white border-t-4 border-gold-accent p-3 rounded shadow-sm text-center w-full border border-sand-100">
                                                <div class="font-bold text-slate-800">REGA</div>
                                                <div class="text-[10px] text-white bg-gold-accent px-2 py-0.5 rounded-full inline-block mt-1 font-bold" data-i18n="tree_rega_role">è¡Œä¸šç›‘ç®¡</div>
                                            </div>
                                            <div class="h-4 connector-v"></div>
                                            <div class="bg-sand-50 border border-sand-200 rounded p-3 w-full space-y-2 shadow-inner">
                                                <div class="text-[10px] text-center font-bold text-gray-400 uppercase" data-i18n="tree_platforms">ä¸‹å±å¹³å°</div>
                                                <div class="grid gap-1.5">
                                                    <div class="bg-white border border-sand-100 rounded px-2 py-1.5 text-xs text-center text-slate-600 font-medium hover:text-saudi-green hover:border-saudi-green cursor-default transition-colors">Ejar</div>
                                                    <div class="bg-white border border-sand-100 rounded px-2 py-1.5 text-xs text-center text-slate-600 font-medium hover:text-saudi-green hover:border-saudi-green cursor-default transition-colors">Wafi</div>
                                                    <div class="bg-white border border-sand-100 rounded px-2 py-1.5 text-xs text-center text-slate-600 font-medium hover:text-saudi-green hover:border-saudi-green cursor-default transition-colors">Mullak</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- NHC (Partner) -->
                                        <div class="flex flex-col items-center">
                                            <div class="eco-node bg-white border-2 border-green-600 border-dashed p-4 rounded shadow-sm text-center w-full border border-sand-100 h-full flex flex-col justify-center">
                                                <div class="font-bold text-slate-800">NHC</div>
                                                <div class="text-xs text-green-600 font-bold mt-1" data-i18n="tree_nhc_role">æœ€å¤§åœ°ä¸» / å›½ä¼</div>
                                            </div>
                                        </div>

                                        <!-- Etmam (Service) -->
                                        <div class="flex flex-col items-center">
                                            <div class="eco-node bg-white border-t-4 border-saudi-green-light p-3 rounded shadow-sm text-center w-full border border-sand-100">
                                                <div class="font-bold text-slate-800">Etmam</div>
                                                <div class="text-[10px] text-white bg-saudi-green-light px-2 py-0.5 rounded-full inline-block mt-1 font-bold" data-i18n="tree_etmam_role">ç»¿è‰²é€šé“</div>
                                            </div>
                                            <div class="h-4 connector-v"></div>
                                            <div class="bg-white border border-sand-200 rounded p-2 text-xs text-center w-full text-slate-600 font-bold shadow-sm">
                                                Balady <br><span class="text-[10px] font-normal text-gray-400" data-i18n="tree_tech_plat">æŠ€æœ¯å¹³å°</span>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <!-- Right: RCRC System (Aligned Grid) -->
                                <div class="flex flex-col items-center">
                                    <div class="eco-node bg-white border-t-4 border-saudi-green p-5 rounded-lg shadow-sm text-center w-full max-w-[280px] border border-sand-100 hover:border-saudi-green/30">
                                        <div class="font-bold text-slate-800 text-lg">RCRC</div>
                                        <div class="text-xs text-gray-400 mt-1 font-medium bg-gray-50 inline-block px-2 py-0.5 rounded" data-i18n="tree_rcrc_role">åˆ©é›…å¾—é¡¶å±‚æˆ˜ç•¥è®¾è®¡</div>
                                    </div>
                                    <div class="h-8 connector-v"></div>
                                    <div class="eco-node bg-white border-l-4 border-slate-500 p-4 rounded shadow-sm text-center w-full max-w-[220px] border border-sand-100">
                                        <div class="font-bold text-slate-800">Riyadh Amanah</div>
                                        <div class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1" data-i18n="tree_amanah_role">å¸‚æ”¿ç½² (æ‰§è¡Œ)</div>
                                        <div class="text-[10px] text-gray-400 border-t border-gray-100 pt-1" data-i18n="tree_amanah_desc">å‘è¯ / éªŒæ”¶ / æ‰§æ³•</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- External Supports -->
                            <div class="w-full border-t-2 border-dashed border-sand-200 pt-8 mt-6">
                                <div class="text-center text-xs text-gray-400 mb-4 font-bold uppercase tracking-widest bg-white inline-block px-4 -mt-11 mx-auto relative z-20" data-i18n="tree_ext_support">å…³é”®å¤–éƒ¨åä½œæœºæ„</div>
                                <div class="flex flex-wrap justify-center gap-4">
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">MISA</div>
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">MC</div>
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">ZATCA</div>
                                    <div class="px-4 py-2 bg-white border border-sand-200 rounded shadow-sm text-xs font-bold text-slate-600 hover:border-gold-accent hover:text-gold-accent transition cursor-default">Civil Defense</div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- VIEW 2: WORKFLOW -->
                <div id="workflow" class="section-content hidden animate-fade-in">
                    <header class="mb-8 border-b-2 border-gold-accent pb-4">
                        <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green" data-i18n="flow_title">ä¸šåŠ¡å…¨æµç¨‹äº¤äº’æŒ‡å¼•</h1>
                        <p class="mt-4 text-base md:text-lg text-slate-600 leading-relaxed" data-i18n="flow_subtitle">
                            ä»å…¬å¸è®¾ç«‹åˆ°äº§ç”Ÿæ”¶å…¥çš„ä¸»è¦åˆè§„èŠ‚ç‚¹ï¼Œæ¯ä¸€æ­¥éƒ½å…³ä¹é¡¹ç›®æˆè´¥ã€‚
                        </p>
                    </header>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                        <!-- Step List -->
                        <div class="lg:col-span-4 space-y-3" id="workflow-steps-container">
                            <!-- JS Injected -->
                        </div>
                        <!-- Detail View -->
                        <div class="lg:col-span-8 bg-white border border-sand-200 rounded-xl p-8 shadow-card relative overflow-hidden flex flex-col justify-center min-h-[400px]" id="workflow-content">
                            <!-- JS Injected -->
                        </div>
                    </div>
                </div>

                <!-- VIEW 3: DIRECTORY (Expanded to all 16) -->
                <div id="directory" class="section-content block animate-fade-in">
                    <header class="mb-8 border-b-2 border-gold-accent pb-6 flex flex-col md:flex-row justify-between items-end gap-4">
                        <div>
                            <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green" data-i18n="dir_title">æœºæ„ç™¾ç§‘å…¨ä¹¦</h1>
                            <p class="mt-2 text-base text-slate-600 leading-relaxed" data-i18n="dir_subtitle">
                                æ”¶å½• 17 ä¸ªæ ¸å¿ƒç›¸å…³çš„éƒ¨å§”ã€æ€»å±€ã€å¹³å°ä¸å›½ä¼ã€‚
                            </p>
                        </div>
                        <div class="relative w-full md:w-72">
                            <input type="text" id="searchInput" placeholder="..." class="pl-10 pr-4 py-2.5 border border-sand-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-saudi-green w-full text-sm bg-white shadow-sm">
                            <svg class="w-4 h-4 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </header>

                    <!-- Type Filters -->
                    <div class="flex flex-wrap gap-2 mb-8" id="filter-container"></div>

                    <!-- Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5" id="directory-grid">
                        <!-- Cards JS Injected -->
                    </div>
                </div>

                <!-- VIEW 4: LEGAL LIBRARY (Refined) -->
                <div id="legal" class="section-content hidden animate-fade-in">
                    <header class="mb-8 border-b-2 border-gold-accent pb-4">
                        <h1 class="text-3xl lg:text-4xl font-bold text-saudi-green" data-i18n="law_title">æˆ¿åœ°äº§æ³•å¾‹æ³•è§„åº“</h1>
                        <p class="mt-4 text-base md:text-lg text-slate-600 leading-relaxed" data-i18n="law_subtitle">
                            ä¸ Smart Oasis ä¸šåŠ¡ç´§å¯†ç›¸å…³çš„ç°è¡Œæ³•å¾‹æ¡†æ¶ä¸åˆè§„è¦ç‚¹ã€‚
                        </p>
                    </header>
                    
                    <div class="space-y-4 max-w-4xl" id="legal-list">
                        <!-- JS Injected -->
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- AI Chat Widget -->
    <div id="ai-chat-panel" class="fixed top-0 right-0 h-full w-full md:w-[400px] bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50 flex flex-col border-l border-sand-200">
        <!-- Header -->
        <div class="bg-saudi-green p-4 flex justify-between items-center text-white shadow-md">
            <div class="flex items-center space-x-3">
                <div class="bg-white/10 p-1.5 rounded-lg">
                    <span class="text-xl">âœ¨</span>
                </div>
                <div>
                    <h3 class="font-bold text-lg" data-i18n="ai_title">æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹</h3>
                    <p class="text-[10px] text-saudi-green-light opacity-90 uppercase tracking-wider">Powered by Gemini 2.5</p>
                </div>
            </div>
            <button onclick="toggleAIChat()" class="hover:bg-white/10 p-2 rounded-lg transition text-white/80 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        
        <!-- Chat Area -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 bg-sand-50/50 flex flex-col space-y-4">
            <!-- Initial AI Message injected via JS -->
            
            <!-- Suggested Questions -->
            <div class="flex flex-wrap gap-2 mt-2 px-1" id="chat-suggestions">
                <!-- Injected via JS -->
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-white border-t border-gray-200">
            <div class="relative">
                <input type="text" id="user-input" class="w-full border border-gray-300 rounded-xl pl-4 pr-12 py-3 focus:outline-none focus:border-saudi-green focus:ring-1 focus:ring-saudi-green transition shadow-inner bg-gray-50 focus:bg-white" placeholder="..." onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()" class="absolute right-2 top-2 bg-saudi-green text-white p-1.5 rounded-lg hover:bg-saudi-green-light transition shadow-sm">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div class="text-[10px] text-gray-400 text-center mt-2" data-i18n="ai_disclaimer">
                AIç”Ÿæˆå†…å®¹å¯èƒ½åŒ…å«é”™è¯¯ï¼Œè¯·ä»¥å®˜æ–¹æ–‡ä»¶ä¸ºå‡†ã€‚
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div id="chat-overlay" onclick="toggleAIChat()" class="fixed inset-0 bg-black/30 z-40 hidden transition-opacity duration-300 backdrop-blur-sm"></div>

    <!-- JS Logic -->
    <script>
        // --- GLOBAL STATE ---
        let currentLang = 'zh';

        // --- TRANSLATIONS DICTIONARY ---
        const translations = {
            zh: {
                kb_subtitle: "çŸ¥è¯†åº“",
                nav_dashboard: "ç”Ÿæ€å…¨æ™¯å›¾",
                nav_workflow: "ä¸šåŠ¡æµç¨‹",
                nav_directory: "æœºæ„ç™¾ç§‘å…¨ä¹¦",
                nav_legal: "æ³•å¾‹æ³•è§„åº“",
                ai_assistant_btn: "æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹",
                
                dash_title: "æ²™ç‰¹æˆ¿åœ°äº§æƒåŠ›ç”Ÿæ€å…¨æ™¯",
                dash_subtitle: "ç†æ¸…æ²™ç‰¹æ”¿åºœæœºæ„çš„éš¶å±ã€ç›‘ç®¡ä¸æ‰§è¡Œå…³ç³»ï¼Œè¯†åˆ«â€œè£åˆ¤å‘˜â€ä¸â€œè¿åŠ¨å‘˜â€ã€‚",
                
                comp_title: "æ²™ç‰¹è¡Œæ”¿ä½“ç³» vs ä¸­å›½ä½“ç³» (å·®å¼‚å¯¹æ¯”)",
                comp_core_diff: "æ ¸å¿ƒé€»è¾‘å·®å¼‚",
                comp_intro: "æ²™ç‰¹è¡Œæ”¿ä½“ç³»æ²¡æœ‰ä¸­å›½ä¸¥æ ¼çš„â€œçœå…-å¸‚å±€-å¿å±€â€å‚ç›´ç®¡ç†ä½“ç³»ï¼Œè€Œæ˜¯å‘ˆç°<strong>â€œä¸­å¤®éƒ¨å§”å†³ç­– + å¼ºåŠ›æ€»å±€ç›‘ç®¡ + åœ°åŒºå¸‚æ”¿ç½²æ‰§è¡Œâ€</strong>çš„æ‰å¹³åŒ–æ ¼å±€ã€‚",
                comp_ministry: "å†³ç­–å±‚ (Ministry / éƒ¨):",
                comp_ministry_desc: "ç±»ä¼¼ä¸­å›½çš„ä¸­å¤®éƒ¨å§”ï¼ˆå¦‚ä½å»ºéƒ¨ï¼‰ã€‚ä¸»è¦è´Ÿè´£åˆ¶å®šå›½å®¶æˆ˜ç•¥ã€å®è§‚æ”¿ç­–å’Œæ³•å¾‹æ¡†æ¶ï¼Œé€šå¸¸ä¸ç›´æ¥å¤„ç†å…·ä½“ä¼ä¸šçš„çäº‹ã€‚",
                comp_authority: "ç›‘ç®¡å±‚ (Authority / æ€»å±€):",
                comp_authority_desc: "æˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„å±‚çº§ã€‚å®ƒä»¬å¾€å¾€æ‹¥æœ‰æé«˜çš„ç‹¬ç«‹æ€§å’Œæ‰§æ³•æƒï¼Œä¸“é—¨è´Ÿè´£æŸä¸ªå‚ç›´é¢†åŸŸçš„å‘ç‰Œã€ç›‘ç®¡å’Œå¤„ç½šï¼ˆå¦‚æˆ¿åœ°äº§æ€»å±€REGAï¼‰ã€‚",
                comp_amanah: "æ‰§è¡Œå±‚ (Amanah / å¸‚æ”¿ç½²):",
                comp_amanah_desc: "æ²™ç‰¹æ²¡æœ‰â€œçœæˆ¿ç®¡å±€â€ï¼Œåœ°æ–¹ä¸Šçš„å…·ä½“æ‰§è¡Œï¼ˆå¦‚å‘æ–½å·¥è¯ã€ä¿®è·¯ã€æ”¶åƒåœ¾ï¼‰å…¨éƒ¨ç”±å„åŸå¸‚çš„ Amanah è´Ÿè´£ã€‚",
                comp_gre: "G.R.E.s (å›½å®¶é˜Ÿ):",
                comp_gre_desc: "ç±»ä¼¼ä¸­å›½çš„å¤®ä¼ï¼ˆå¦‚ä¸­å»ºã€ä¸­é“ï¼‰ï¼Œä½†åœ¨æ²™ç‰¹ï¼Œå®ƒä»¬æ‰¿æ‹…äº†éƒ¨åˆ†â€œæ”¿åºœèŒèƒ½â€ï¼Œå¦‚å›½å®¶ä½æˆ¿å…¬å¸ï¼ˆNHCï¼‰ï¼Œæ—¢æ˜¯æˆ‘ä»¬çš„ç«äº‰å¯¹æ‰‹ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€å¤§çš„åˆä½œä¼™ä¼´ã€‚",

                tree_king: "å›½ç‹ / å†…é˜",
                tree_momah_role: "æˆ¿åœ°äº§æœ€é«˜ä¸»ç®¡éƒ¨é—¨",
                tree_rega_role: "è¡Œä¸šç›‘ç®¡",
                tree_platforms: "ä¸‹å±å¹³å°",
                tree_nhc_role: "æœ€å¤§åœ°ä¸» / å›½ä¼",
                tree_etmam_role: "ç»¿è‰²é€šé“",
                tree_tech_plat: "æŠ€æœ¯å¹³å°",
                tree_rcrc_role: "åˆ©é›…å¾—é¡¶å±‚æˆ˜ç•¥è®¾è®¡",
                tree_amanah_role: "å¸‚æ”¿ç½² (æ‰§è¡Œ)",
                tree_amanah_desc: "å‘è¯ / éªŒæ”¶ / æ‰§æ³•",
                tree_ext_support: "å…³é”®å¤–éƒ¨åä½œæœºæ„",

                flow_title: "ä¸šåŠ¡å…¨æµç¨‹äº¤äº’æŒ‡å¼•",
                flow_subtitle: "ä»å…¬å¸è®¾ç«‹åˆ°äº§ç”Ÿæ”¶å…¥çš„ä¸»è¦åˆè§„èŠ‚ç‚¹ï¼Œæ¯ä¸€æ­¥éƒ½å…³ä¹é¡¹ç›®æˆè´¥ã€‚",
                flow_step_label: "å½“å‰é˜¶æ®µ",

                dir_title: "æœºæ„ç™¾ç§‘å…¨ä¹¦",
                dir_subtitle: "æ”¶å½• 17 ä¸ªæ ¸å¿ƒç›¸å…³çš„éƒ¨å§”ã€æ€»å±€ã€å¹³å°ä¸å›½ä¼ã€‚",
                search_placeholder: "æœç´¢æœºæ„åç§°æˆ–ç¼©å†™...",
                dir_filter_all: "å…¨éƒ¨",
                dir_filter_ministry: "éƒ¨å§”",
                dir_filter_authority: "æ€»å±€",
                dir_filter_execution: "æ‰§è¡Œ",
                dir_filter_platform: "å¹³å°",
                dir_filter_partner: "å›½ä¼",
                dir_expand: "å±•å¼€è¯¦ç»†èŒèƒ½",
                dir_no_result: "æœªæ‰¾åˆ°åŒ¹é…çš„æœºæ„",

                law_title: "æˆ¿åœ°äº§æ³•å¾‹æ³•è§„åº“",
                law_subtitle: "ä¸ Smart Oasis ä¸šåŠ¡ç´§å¯†ç›¸å…³çš„ç°è¡Œæ³•å¾‹æ¡†æ¶ä¸åˆè§„è¦ç‚¹ã€‚",
                law_impact: "æ ¸å¿ƒå†…å®¹ä¸å½±å“ï¼š",

                ai_title: "æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹",
                ai_welcome: "ä½ å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ Smart Oasis å†…éƒ¨çŸ¥è¯†åŠ©æ‰‹ã€‚<br><br>æ‚¨å¯ä»¥é—®æˆ‘å…³äº<strong>æœºæ„èŒèƒ½ï¼ˆå¦‚REGA, MOMAHï¼‰ã€åŠäº‹æµç¨‹ã€æˆ–æ³•å¾‹æ³•è§„</strong>çš„é—®é¢˜ã€‚",
                ai_q1: "ğŸ›ï¸ REGA vs MOMAH",
                ai_q2: "ğŸ—ï¸ å¼€å‘æµç¨‹",
                ai_q3: "ğŸŒ å¸‚åœºå‡†å…¥",
                ai_input_placeholder: "è¾“å…¥é—®é¢˜...",
                ai_disclaimer: "AIç”Ÿæˆå†…å®¹å¯èƒ½åŒ…å«é”™è¯¯ï¼Œè¯·ä»¥å®˜æ–¹æ–‡ä»¶ä¸ºå‡†ã€‚",
            },
            en: {
                kb_subtitle: "Knowledge Base",
                nav_dashboard: "Ecosystem Panorama",
                nav_workflow: "Workflow Guide",
                nav_directory: "Encyclopedia",
                nav_legal: "Legal Library",
                ai_assistant_btn: "AI Assistant",

                dash_title: "Real Estate Power Ecosystem",
                dash_subtitle: "Mapping relationships between Ministries, Regulators, and Executors. Identifying 'Referees' vs 'Players'.",

                comp_title: "Saudi Admin System vs China System",
                comp_core_diff: "Core Strategic Difference",
                comp_intro: "Unlike China's strict vertical hierarchy, Saudi Arabia presents a flat structure: <strong>'Central Ministry Policy + Powerful Authority Regulation + Local Municipality Execution'</strong>.",
                comp_ministry: "Strategy (Ministry):",
                comp_ministry_desc: "Similar to Central Ministries. Responsible for national strategy, macro policies, and legal frameworks.",
                comp_authority: "Regulation (Authority):",
                comp_authority_desc: "High priority level. Independent entities with enforcement power for specific sectors (e.g., REGA), focusing on licensing and regulation.",
                comp_amanah: "Execution (Amanah):",
                comp_amanah_desc: "Local execution (permits, roads, waste) is handled entirely by the city's Amanah. There is no provincial housing bureau.",
                comp_gre: "G.R.E.s (State-Owned):",
                comp_gre_desc: "Government-Related Entities like NHC. They assume some 'government functions' while being commercial entities. They are both partners and competitors.",

                tree_king: "King / Council",
                tree_momah_role: "Supreme Authority",
                tree_rega_role: "Regulator",
                tree_platforms: "Platforms",
                tree_nhc_role: "Landlord / GRE",
                tree_etmam_role: "Fast Track",
                tree_tech_plat: "Tech Platform",
                tree_rcrc_role: "Riyadh Strategy",
                tree_amanah_role: "Municipality",
                tree_amanah_desc: "Permits / Inspection",
                tree_ext_support: "Key External Support",

                flow_title: "Full Business Lifecycle Workflow",
                flow_subtitle: "Key compliance milestones from company establishment to revenue generation.",
                flow_step_label: "Current Stage",

                dir_title: "Agency Encyclopedia",
                dir_subtitle: "Profiling 17 core Ministries, Authorities, Platforms, and GREs.",
                search_placeholder: "Search agency name...",
                dir_filter_all: "All",
                dir_filter_ministry: "Ministry",
                dir_filter_authority: "Authority",
                dir_filter_execution: "Execution",
                dir_filter_platform: "Platform",
                dir_filter_partner: "GRE/Partner",
                dir_expand: "View Details",
                dir_no_result: "No agencies found.",

                law_title: "Legal & Regulation Library",
                law_subtitle: "Key legal frameworks and compliance points relevant to Smart Oasis.",
                law_impact: "Core Impact:",

                ai_title: "Smart AI Assistant",
                ai_welcome: "Hello! I am your Smart Oasis internal knowledge assistant.<br><br>Ask me about <strong>Agency Roles (REGA, MOMAH), Processes, or Regulations</strong>.",
                ai_q1: "ğŸ›ï¸ REGA vs MOMAH",
                ai_q2: "ğŸ—ï¸ Dev Process",
                ai_q3: "ğŸŒ Market Entry",
                ai_input_placeholder: "Ask a question...",
                ai_disclaimer: "AI generated content may contain errors.",
            }
        };

        // --- DATASET (Bilingual) ---
        const agencyData = [
            { 
                id: 'momah', 
                name: { zh: 'å¸‚æ”¿ä¸ä½æˆ¿éƒ¨', en: 'MOMAH' }, 
                abbr: 'MOMAH', 
                type: 'ministry', 
                role: { zh: 'æ ¸å¿ƒä¸»ç®¡ / è¶…çº§éƒ¨å§”', en: 'Ministry / Supreme Authority' }, 
                desc: { 
                    zh: 'æˆ¿åœ°äº§æœ€é«˜ä¸»ç®¡éƒ¨é—¨ï¼Œç”±åŸå¸‚æ”¿éƒ¨ä¸ä½æˆ¿éƒ¨åˆå¹¶è€Œæˆã€‚å†…é˜æ ¸å¿ƒéƒ¨å§”ï¼Œä½“é‡åºå¤§ã€‚', 
                    en: 'Ministry of Municipal & Rural Affairs and Housing. The supreme authority for the real estate sector.' 
                }, 
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>momrah.gov.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>æ—¢ç®¡å®è§‚æ”¿ç­–ï¼ˆä½æˆ¿ä¾›ç»™ï¼‰ï¼Œåˆç®¡å¾®è§‚å¸‚æ”¿ï¼ˆè¡—é“å«ç”Ÿï¼‰ã€‚<br><strong>å…³é”®èŒèƒ½ï¼š</strong><br>1. <strong>åŸå¸‚è§„åˆ’ä»£ç†éƒ¨</strong>ï¼šå®¡æ‰¹å¤§åŒºåŸŸè§„åˆ’ä¸Zoningå˜æ›´ã€‚<br>2. <strong>å¼€å‘å•†æœåŠ¡ä¸­å¿ƒ (Etmam)</strong>ï¼šå¼€å‘å•†çš„ç»¿è‰²é€šé“ã€‚<br>3. <strong>Baladyå¹³å°</strong>ï¼šæ•°å­—åŒ–é—¨æˆ·ï¼Œç”³è¯·æ‰€æœ‰æ–½å·¥/æŒ–æ˜/åœŸåœ°è¯ç…§ã€‚',
                    en: '<strong>Web:</strong> momrah.gov.sa<br><br><strong>Position:</strong> Manages both macro policy (housing supply) and micro municipal services.<br><strong>Key Functions:</strong><br>1. <strong>City Planning Dep</strong>: Approves master plans & zoning.<br>2. <strong>Etmam</strong>: Fast-track for developers.<br>3. <strong>Balady</strong>: Digital portal for all construction permits.'
                }
            },
            { 
                id: 'rega', 
                name: { zh: 'æˆ¿åœ°äº§æ€»å±€', en: 'REGA' }, 
                abbr: 'REGA', 
                type: 'authority', 
                role: { zh: 'è¡Œä¸šç›‘ç®¡ / è£åˆ¤å‘˜', en: 'Regulator / Authority' }, 
                desc: {
                    zh: 'è´Ÿè´£æˆ¿åœ°äº§è¡Œä¸šçš„ç«‹æ³•ã€å‘ç‰Œä¸ç›‘ç®¡ã€‚2023å¹´èµ·å¼ºåŠ›æ‰§è¡Œã€Šæˆ¿åœ°äº§ç»çºªæ³•ã€‹ã€‚',
                    en: 'Real Estate General Authority. Responsible for legislation, licensing, and regulation of the sector.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>rega.gov.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>ç®¡äººï¼ˆä¸­ä»‹ï¼‰ã€ç®¡è¡Œä¸ºï¼ˆäº¤æ˜“ï¼‰ã€ç®¡æ•°æ®ã€‚è¡Œæ”¿ç‹¬ç«‹ä½†å—MOMAHéƒ¨é•¿é¢†å¯¼ã€‚<br><strong>æ ¸å¿ƒè¾–åŒºï¼š</strong><br>1. <strong>Ejar</strong>ï¼šç§Ÿèµå¼ºåˆ¶å¤‡æ¡ˆã€‚<br>2. <strong>Wafi</strong>ï¼šæœŸæˆ¿é”€å”®ä¸èµ„é‡‘ç›‘ç®¡ã€‚<br>3. <strong>Mullak</strong>ï¼šåˆ†å¥‘å¼äº§æƒä¸ä¸šä¸»åä¼šæ³¨å†Œã€‚',
                    en: '<strong>Web:</strong> rega.gov.sa<br><br><strong>Position:</strong> Regulates people (brokers), behavior (transactions), and data.<br><strong>Core Jurisdictions:</strong><br>1. <strong>Ejar</strong>: Rental agreements.<br>2. <strong>Wafi</strong>: Off-plan sales & escrow.<br>3. <strong>Mullak</strong>: HOA & Co-ownership.'
                }
            },
            { 
                id: 'rcrc', 
                name: { zh: 'åˆ©é›…å¾—çš‡å®¶å§”å‘˜ä¼š', en: 'RCRC' }, 
                abbr: 'RCRC', 
                type: 'ministry', 
                role: { zh: 'æˆ˜ç•¥é¡¶å±‚ / è¶…çº§å¤§è„‘', en: 'Strategic Top-Level' }, 
                desc: {
                    zh: 'ç›´å±å†…é˜ï¼Œç‹å‚¨æŒ‚å¸…ã€‚åœ¨åˆ©é›…å¾—ï¼Œå…¶æˆ˜ç•¥åœ°ä½é«˜äºå¸‚æ”¿ç½²ã€‚',
                    en: 'Royal Commission for Riyadh City. Reports directly to the Cabinet. Higher strategic status than the Municipality.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>rcrc.gov.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>åˆ©é›…å¾—çœŸæ­£çš„æˆ˜ç•¥åˆ¶å®šè€…ï¼ŒæœåŠ¡äºâ€œ2030æ„¿æ™¯â€ã€‚<br><strong>èŒèƒ½ï¼š</strong>è´Ÿè´£åˆ©é›…å¾—å¤§éƒ½å¸‚åœˆæ€»ä½“è§„åˆ’ï¼ˆå¦‚Metro, Riyadh Greenï¼‰ã€‚',
                    en: '<strong>Web:</strong> rcrc.gov.sa<br><br><strong>Position:</strong> The true strategist for Riyadh, serving Vision 2030.<br><strong>Function:</strong> Master planning for Riyadh Metropolitan area (Metro, Riyadh Green, etc.).'
                }
            },
            { 
                id: 'amanah', 
                name: { zh: 'åˆ©é›…å¾—å¸‚æ”¿ç½²', en: 'Riyadh Municipality' }, 
                abbr: 'Amanah', 
                type: 'execution', 
                role: { zh: 'åœ°æ–¹æ‰§è¡Œ / åœ°æ–¹è¯¸ä¾¯', en: 'Local Execution' }, 
                desc: {
                    zh: 'å‚ç›´éš¶å±äºMOMAHï¼Œæ‹¥æœ‰æå¤§çš„åœ°æ–¹è‡ªç”±è£é‡æƒã€‚',
                    en: 'Vertically reports to MOMAH but has significant local discretion.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>alriyadh.gov.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>æˆ˜ç•¥å¬RCRCï¼Œæ”¿ç­–å¬MOMAHï¼Œå…·ä½“è½åœ°Amanahè¯´äº†ç®—ã€‚<br><strong>èŒèƒ½ï¼š</strong><br>1. <strong>å‘è¯</strong>ï¼šç›–ç« ã€Šå»ºç­‘æ–½å·¥è®¸å¯è¯ã€‹å’Œã€Šå®Œå·¥è¯ã€‹ã€‚<br>2. <strong>æ‰§æ³•</strong>ï¼šè´Ÿè´£ç°åœºæ£€æŸ¥ã€å«ç”Ÿåˆè§„ã€è¿å»ºç½šæ¬¾ã€‚',
                    en: '<strong>Web:</strong> alriyadh.gov.sa<br><br><strong>Position:</strong> Strategy from RCRC, Policy from MOMAH, Execution by Amanah.<br><strong>Function:</strong><br>1. <strong>Permits</strong>: Building Permits & Completion Certificates.<br>2. <strong>Enforcement</strong>: Site inspections & fines.'
                }
            },
            { 
                id: 'nhc', 
                name: { zh: 'å›½å®¶ä½æˆ¿å…¬å¸', en: 'NHC' }, 
                abbr: 'NHC', 
                type: 'partner', 
                role: { zh: 'å›½ä¼åœ°ä¸» / æˆ¿äº§ç•Œé˜¿ç¾', en: 'State-Owned / Landlord' }, 
                desc: {
                    zh: 'MOMAHçš„æŠ•èµ„è‡‚è†€ï¼Œæ²™ç‰¹æœ€å¤§çš„ä½å®…ç”¨åœ°æŒæœ‰è€…ã€‚',
                    en: 'National Housing Company. The investment arm of MOMAH and largest holder of residential land.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>nhc.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>æ—¢æ˜¯ç›‘ç®¡æ–¹ï¼ˆæ ‡å‡†åˆ¶å®šï¼‰ï¼Œåˆæ˜¯æœ€å¤§åˆä½œä¼™ä¼´ã€‚<br><strong>åˆä½œä»·å€¼ï¼š</strong><br>1. <strong>æ‹¿åœ°</strong>ï¼šæŒæ¡å¤§é‡æ”¿åºœåˆ’æ‹¨åœŸåœ°ã€‚<br>2. <strong>é”€å”®</strong>ï¼šæ‹¥æœ‰Sakaniæ•°æ®åº“ï¼Œç›´æ¥å¯¹æ¥æ”¿åºœè¡¥è´´è´­æˆ¿å®¢ç¾¤ã€‚',
                    en: '<strong>Web:</strong> nhc.sa<br><br><strong>Position:</strong> Both a regulator (standards) and a partner.<br><strong>Value:</strong><br>1. <strong>Land</strong>: Controls vast government land banks.<br>2. <strong>Sales</strong>: Access to Sakani beneficiary database.'
                }
            },
             { 
                id: 'roshn', 
                name: { zh: 'ROSHN ç½—ç”³', en: 'ROSHN' }, 
                abbr: 'ROSHN', 
                type: 'partner', 
                role: { zh: 'ç¤¾åŒºç¼”é€ è€… / PIFå…¨èµ„', en: 'PIF Giga-Project' }, 
                desc: {
                    zh: 'PIFæ——ä¸‹çš„å¤§å‹æˆ¿åœ°äº§å¼€å‘å•†ï¼Œä¸“æ³¨äºå»ºè®¾é«˜å“è´¨çš„ç»¼åˆç¤¾åŒºã€‚',
                    en: 'PIF-owned real estate developer focusing on high-quality integrated communities.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>roshn.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>æ²™ç‰¹â€œ2030æ„¿æ™¯â€çš„å…³é”®æ¨åŠ¨è€…ä¹‹ä¸€ã€‚<br><strong>ç‰¹ç‚¹ï¼š</strong>ä¸åŒäºNHCçš„å¹³å°å±æ€§ï¼ŒROSHNæ›´åƒæ˜¯ä¸€ä¸ªè¶…çº§å¼€å‘å•†ï¼Œç›´æ¥ä¸‹åœºæ‹¿åœ°ç›–æˆ¿ã€‚',
                    en: '<strong>Web:</strong> roshn.sa<br><br><strong>Position:</strong> Key enabler of Vision 2030 to increase home ownership.<br><strong>Role:</strong> A "Super Developer" building massive communities nationwide (e.g., Sedra).'
                }
            },
            { 
                id: 'misa', 
                name: { zh: 'æŠ•èµ„éƒ¨', en: 'MISA' }, 
                abbr: 'MISA', 
                type: 'ministry', 
                role: { zh: 'å¤–èµ„å‡†å…¥ / æ‹›å•†å±€', en: 'Ministry / Investment' }, 
                desc: {
                    zh: 'è´Ÿè´£å‘æ”¾ã€ŠæŠ•èµ„è®¸å¯è¯ã€‹(MISA License)ï¼Œå¤–èµ„ç»è¥çš„â€œèº«ä»½è¯â€ã€‚',
                    en: 'Ministry of Investment. Issues the Investment License (MISA License).'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>misa.gov.sa<br><br><strong>ç”Ÿæ€ä½ï¼š</strong>å¤–èµ„ä¼ä¸šçš„ä¿æŠ¤ä¼å’Œè·¨éƒ¨é—¨åè°ƒäººã€‚<br><strong>èŒèƒ½ï¼š</strong>æ ¸å‘æŠ•èµ„è®¸å¯ï¼Œå‰èº«ä¸ºSAGIAã€‚',
                    en: '<strong>Web:</strong> misa.gov.sa<br><br><strong>Position:</strong> Gateway for foreign investors.<br><strong>Function:</strong> Issuing investment licenses. The primary contact for cross-government coordination.'
                }
            },
            { 
                id: 'mc', 
                name: { zh: 'å•†åŠ¡éƒ¨', en: 'Min. of Commerce' }, 
                abbr: 'MC', 
                type: 'ministry', 
                role: { zh: 'å•†ä¸šæ³¨å†Œ / å·¥å•†å±€', en: 'Ministry / Registry' }, 
                desc: {
                    zh: 'è´Ÿè´£å…¬å¸å•†ä¸šç™»è®°(CR)ä¸å…¬å¸æ³•æ‰§è¡Œã€‚',
                    en: 'Responsible for Commercial Registration (CR) and Company Law.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>mc.gov.sa<br><br><strong>èŒèƒ½ï¼š</strong>å‘æ”¾ã€Šå•†ä¸šç™»è®°è¯ã€‹(CR)ï¼Œæ ¸å®šå…¬å¸ç±»å‹ï¼ˆå¦‚LLCï¼‰å’Œç»è¥èŒƒå›´ã€‚',
                    en: '<strong>Web:</strong> mc.gov.sa<br><br><strong>Function:</strong> Issuing CRs, determining company types (LLC, etc.) and business activities.'
                }
            },
            { 
                id: 'etmam', 
                name: { zh: 'å¼€å‘å•†æœåŠ¡ä¸­å¿ƒ', en: 'Etmam Center' }, 
                abbr: 'Etmam', 
                type: 'ministry', 
                role: { zh: 'ç»¿è‰²é€šé“', en: 'Fast Track Service' }, 
                desc: {
                    zh: 'MOMAHä¸‹å±çš„ä¸€ç«™å¼å®¡æ‰¹ä¸­å¿ƒï¼ŒåŠ é€Ÿå¤§é¡¹ç›®æµç¨‹ã€‚',
                    en: 'One-stop approval center under MOMAH to accelerate mega-projects.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>etmam.com.sa<br><br><strong>æ ¸å¿ƒä»·å€¼ï¼š</strong>MOMAHç”¨æ¥å€’é€¼å…¶ä»–éƒ¨é—¨æé«˜æ•ˆç‡çš„å·¥å…·ã€‚ä¸ä»…æ˜¯çª—å£ï¼Œæ›´æ˜¯è·¨éƒ¨é—¨åè°ƒå™¨ã€‚',
                    en: '<strong>Web:</strong> etmam.com.sa<br><br><strong>Value:</strong> A tool to force efficiency across departments. It acts as a cross-agency coordinator.'
                }
            },
            { 
                id: 'balady', 
                name: { zh: 'Balady å¹³å°', en: 'Balady Platform' }, 
                abbr: 'Balady', 
                type: 'platform', 
                role: { zh: 'å¸‚æ”¿è®¸å¯', en: 'Municipal Permits' }, 
                desc: {
                    zh: 'MOMAHçš„æ•°å­—åŒ–é—¨æˆ·ï¼Œåœ¨çº¿ç”³è¯·æ–½å·¥è¯ã€‚',
                    en: 'Digital portal for municipal services, specifically Construction Permits.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>balady.gov.sa<br><br><strong>å¿…ç”¨å¹³å°ï¼š</strong>æ‰€æœ‰ä¸åœŸåœ°ã€å»ºè®¾ã€æŒ–æ˜ç›¸å…³çš„è®¸å¯è¯å‡åœ¨æ­¤å¹³å°å…¨æ•°å­—åŒ–ç”³è¯·ã€‚',
                    en: '<strong>Web:</strong> balady.gov.sa<br><br><strong>Usage:</strong> Mandatory platform for land, construction, and excavation permits.'
                }
            },
            { 
                id: 'ejar', 
                name: { zh: 'Ejar ç§Ÿèµç½‘', en: 'Ejar Network' }, 
                abbr: 'Ejar', 
                type: 'platform', 
                role: { zh: 'ç§Ÿèµå¤‡æ¡ˆ', en: 'Rental Regulation' }, 
                desc: {
                    zh: 'REGAä¸‹å±å¹³å°ï¼Œæ”¿åºœæ§åˆ¶ç§Ÿæˆ¿å¸‚åœºçš„æŠ“æ‰‹ã€‚',
                    en: 'REGA platform for recording all rental contracts.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>ejar.sa<br><br><strong>å¼ºåˆ¶æ€§ï¼š</strong>æ‰“é€šå†…æ”¿éƒ¨ç³»ç»Ÿã€‚é•¿ç§Ÿå…¬å¯“åˆåŒå¿…é¡»å¤‡æ¡ˆï¼Œå¦åˆ™å‘ç”Ÿçº çº·ä¸å—æ³•å¾‹ä¿æŠ¤ã€‚',
                    en: '<strong>Web:</strong> ejar.sa<br><br><strong>Mandatory:</strong> Linked to MOI. Contracts must be registered to be legally enforceable.'
                }
            },
            { 
                id: 'wafi', 
                name: { zh: 'Wafi å§”å‘˜ä¼š', en: 'Wafi Committee' }, 
                abbr: 'Wafi', 
                type: 'platform', 
                role: { zh: 'æœŸæˆ¿ç›‘ç®¡', en: 'Off-plan Sales' }, 
                desc: {
                    zh: 'REGAä¸‹å±ï¼Œç›¸å½“äºâ€œé¢„å”®åŠâ€ã€‚',
                    en: 'Under REGA. Regulates off-plan sales and rent.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>wafi.housing.gov.sa<br><br><strong>æ ¸å¿ƒèŒèƒ½ï¼š</strong>ç®¡ç†æœŸæˆ¿é”€å”®è®¸å¯(Off-plan license)ä¸Escrowèµ„é‡‘ç›‘ç®¡è´¦æˆ·ã€‚',
                    en: '<strong>Web:</strong> wafi.housing.gov.sa<br><br><strong>Function:</strong> Issues Off-plan licenses and manages Escrow accounts.'
                }
            },
            { 
                id: 'mullak', 
                name: { zh: 'Mullak è®¡åˆ’', en: 'Mullak Program' }, 
                abbr: 'Mullak', 
                type: 'platform', 
                role: { zh: 'ä¸šä¸»åä¼š', en: 'HOA Registration' }, 
                desc: {
                    zh: 'REGAä¸‹å±ï¼Œç®¡ç†åˆ†å¥‘å¼äº§æƒã€‚',
                    en: 'Under REGA. Regulates Co-ownership and Home Owner Associations.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>mullak.sa<br><br><strong>åˆè§„è¦æ±‚ï¼š</strong>è¿è¥æ•´æ ‹ç‰©ä¸šæˆ–è¿›è¡Œåˆ†å±‚é”€å”®æ—¶ï¼Œå¿…é¡»åœ¨æ­¤æ³¨å†Œä¸šä¸»å§”å‘˜ä¼š(HOA)ã€‚',
                    en: '<strong>Web:</strong> mullak.sa<br><br><strong>Compliance:</strong> Mandatory for registering HOAs when selling strata title units.'
                }
            },
            { 
                id: 'tourism', 
                name: { zh: 'æ—…æ¸¸éƒ¨', en: 'Min. of Tourism' }, 
                abbr: 'Tourism', 
                type: 'ministry', 
                role: { zh: 'é…’åº—å…¬å¯“ç›‘ç®¡', en: 'Hospitality Reg' }, 
                desc: {
                    zh: 'è´Ÿè´£æ—…æ¸¸ä½å®¿è®¾æ–½çš„æ‰§ç…§é¢å‘ä¸æ˜Ÿçº§è¯„å®šã€‚',
                    en: 'Issues licenses and classifications for hospitality facilities.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>mt.gov.sa<br><br><strong>å…³é”®ç•Œé™ï¼š</strong>è‹¥é•¿ç§Ÿå…¬å¯“æä¾›æ—¥ç§Ÿ/çŸ­ç§Ÿ/å‰å°æœåŠ¡ï¼Œå¿…é¡»ç”±æ—…æ¸¸éƒ¨å‘ç‰Œã€‚',
                    en: '<strong>Web:</strong> mt.gov.sa<br><br><strong>Scope:</strong> If a property offers short-term stays or front-desk services, it needs a Tourism license.'
                }
            },
            { 
                id: 'civil', 
                name: { zh: 'æ°‘é˜²æ€»å±€', en: 'Civil Defense' }, 
                abbr: 'Civil Defense', 
                type: 'execution', 
                role: { zh: 'æ¶ˆé˜²å®‰å…¨ / ä¸€ç¥¨å¦å†³', en: 'Fire Safety' }, 
                desc: {
                    zh: 'éš¶å±å†…æ”¿éƒ¨ï¼Œæ‹¥æœ‰å®Œå·¥éªŒæ”¶çš„ä¸€ç¥¨å¦å†³æƒã€‚',
                    en: 'Under MOI. Has veto power over building completion via fire safety checks.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>998.gov.sa<br><br><strong>ä¸¥è‹›æ ‡å‡†ï¼š</strong>ä»»ä½•å…¬å¯“æ¥¼å¼€ä¸šå‰ï¼Œå¿…é¡»æ‹¿åˆ°æ°‘é˜²å±€çš„æ¶ˆé˜²è®¸å¯è¯ã€‚',
                    en: '<strong>Web:</strong> 998.gov.sa<br><br><strong>Standard:</strong> Mandatory Fire Safety License required before operation.'
                }
            },
            { 
                id: 'zatca', 
                name: { zh: 'ç¨åŠ¡æµ·å…³æ€»å±€', en: 'ZATCA' }, 
                abbr: 'ZATCA', 
                type: 'authority', 
                role: { zh: 'ç¨åŠ¡å¾æ”¶ / è´¢ç¥çˆ·', en: 'Tax & Customs' }, 
                desc: {
                    zh: 'è´Ÿè´£ç®¡ç†å¢å€¼ç¨(VAT)ã€æˆ¿åœ°äº§äº¤æ˜“ç¨(RETT)ã€‚',
                    en: 'Manages VAT, Real Estate Transaction Tax (RETT), and Customs.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>zatca.gov.sa<br><br><strong>æ ¸å¿ƒç¨ç§ï¼š</strong><br>1. <strong>RETT</strong>ï¼šæˆ¿äº§ä¹°å–éœ€ç¼´5%äº¤æ˜“ç¨ã€‚<br>2. <strong>VAT</strong>ï¼šå•†ä¸šç§Ÿèµï¼ˆå¦‚åº•å•†ï¼‰éœ€ç¼´15%ã€‚',
                    en: '<strong>Web:</strong> zatca.gov.sa<br><br><strong>Taxes:</strong><br>1. <strong>RETT</strong>: 5% on RE transactions.<br>2. <strong>VAT</strong>: 15% on commercial leases.'
                }
            },
            { 
                id: 'redf', 
                name: { zh: 'æˆ¿åœ°äº§å‘å±•åŸºé‡‘', en: 'REDF' }, 
                abbr: 'REDF', 
                type: 'partner', 
                role: { zh: 'é‡‘èæ”¯æŒ / èµ„é‡‘æº', en: 'Finance Fund' }, 
                desc: {
                    zh: 'å›½å®¶å‘å±•åŸºé‡‘åºåˆ—ï¼Œä¸»è¦ç»™å…¬æ°‘å‘æˆ¿è´·è¡¥è´´ã€‚',
                    en: 'Provides subsidized housing loans to citizens.'
                },
                details: {
                    zh: '<strong>å®˜ç½‘ï¼š</strong>redf.gov.sa<br><br><strong>å¼€å‘å•†æœºä¼šï¼š</strong>å…³æ³¨å…¶ <strong>Tatweer</strong> è®¡åˆ’ï¼Œè¿™æ˜¯ä¸“é—¨ä¸ºå¼€å‘å•†æä¾›çš„è¿‡æ¡¥èèµ„æ¸ é“ã€‚',
                    en: '<strong>Web:</strong> redf.gov.sa<br><br><strong>Opportunity:</strong> The <strong>Tatweer</strong> program provides bridge financing for developers.'
                }
            }
        ];

        const lawsData = [
            { 
                title: { zh: "æˆ¿åœ°äº§ç»çºªæ³•", en: "Real Estate Brokerage Law" }, 
                date: "2023", 
                desc: { 
                    zh: "å–ç¼”è‡ªç”±ç»çºªäººï¼Œå¼ºåˆ¶ä¸­ä»‹æŒè¯(Fal License)ã€‚è§„èŒƒä½£é‡‘ä¸Šé™ä¸ç‹¬å®¶ä»£ç†åˆåŒã€‚", 
                    en: "Mandates Fal Licenses for brokers. Regulates commission caps and exclusive contracts." 
                } 
            },
            { 
                title: { zh: "æˆ¿åœ°äº§å‚è‚¡/é›†èµ„æ³•", en: "Real Estate Contributions Law" }, 
                date: "2023", 
                desc: { 
                    zh: "è§„èŒƒå¤šæ–¹é›†èµ„ã€ä¼—ç­¹å¼€å‘æˆ¿åœ°äº§çš„è¡Œä¸ºã€‚ç”±CMA(èµ„æœ¬å¸‚åœºå±€)ä¸REGAåŒé‡ç›‘ç®¡ã€‚", 
                    en: "Regulates real estate crowdfunding and joint contributions. Regulated by CMA and REGA." 
                } 
            },
            { 
                title: { zh: "æ°‘äº‹äº¤æ˜“æ³•", en: "Civil Transactions Law" }, 
                date: "2023", 
                desc: { 
                    zh: "æ²™ç‰¹é¦–éƒ¨æ°‘æ³•å…¸ã€‚ç¡®ç«‹äº†åˆåŒç¥åœ£æ€§ï¼Œå‡å°‘äº†æ³•å®˜åŸºäºä¼Šæ–¯å…°æ•™æ³•çš„è‡ªç”±è£é‡æƒã€‚", 
                    en: "Saudi Arabia's first Civil Code. Establishes sanctity of contracts and reduces judicial discretion." 
                } 
            },
            { 
                title: { zh: "å¤–å•†æŠ•èµ„æ³•", en: "Foreign Investment Law" }, 
                date: "Base", 
                desc: { 
                    zh: "ç¡®ç«‹äº†å¤–èµ„ä¸å†…èµ„å¹³ç­‰å¾…é‡åŸåˆ™ã€‚è§„å®šäº†MISAå‘ç‰Œåˆ¶åº¦åŠå¤–èµ„è´Ÿé¢æ¸…å•ã€‚", 
                    en: "Establishes equal treatment for foreign investors. Governs MISA licensing and negative lists." 
                } 
            },
            { 
                title: { zh: "éæ²™ç‰¹äººæˆ¿åœ°äº§æ‰€æœ‰æƒæ³•", en: "Non-Saudi RE Ownership Law" }, 
                date: "Draft", 
                desc: { 
                    zh: "ç›®å‰éæ²™ç‰¹äººåœ¨åˆ©é›…å¾—ä¹°æˆ¿ä»å—é™(éœ€å®¡æ‰¹)ã€‚æ–°æ³•è‰æ¡ˆæ—¨åœ¨è¿›ä¸€æ­¥æ”¾å¼€é™åˆ¶ï¼Œä½†å°šæœªæ­£å¼è½åœ°ã€‚", 
                    en: "Current restrictions on foreign ownership in Riyadh/Mecca. New draft aims to liberalize access." 
                } 
            },
            { 
                title: { zh: "æˆ¿åœ°äº§äº¤æ˜“ç¨æ³• (RETT)", en: "RETT Executive Regulations" }, 
                date: "2020", 
                desc: { 
                    zh: "è§„å®šæˆ¿åœ°äº§å¤„ç½®å…å¾15%å¢å€¼ç¨ï¼Œæ”¹ä¸ºå¾æ”¶5%çš„æˆ¿åœ°äº§äº¤æ˜“ç¨(RETT)ï¼Œé™ä½äº¤æ˜“æˆæœ¬ã€‚", 
                    en: "Exempts RE disposal from 15% VAT, imposing a lower 5% Real Estate Transaction Tax (RETT)." 
                } 
            },
            { 
                title: { zh: "æ°‘é˜²ä¸æ¶ˆé˜²å®‰å…¨æ¡ä¾‹", en: "Civil Defense Fire Code" }, 
                date: "Mandatory", 
                desc: { 
                    zh: "å†…æ”¿éƒ¨é¢å¸ƒçš„ä¸¥æ ¼å»ºç­‘æ¶ˆé˜²æ ‡å‡†ã€‚æ˜¯è·å–å®Œå·¥è¯çš„å‰ç½®æ¡ä»¶ï¼Œæ‹¥æœ‰æœ€é«˜æ‰§æ³•æƒã€‚", 
                    en: "Strict fire safety standards. A prerequisite for Completion Certificates." 
                } 
            }
        ];

        const workflowSteps = [
            { 
                title: { zh: "1. å¸‚åœºå‡†å…¥", en: "1. Market Entry" }, 
                desc: { zh: "è·å–ç»è¥èº«ä»½", en: "Legal Establishment" }, 
                tasks: [
                    { dept: "MISA", txt: { zh: "ç”³è¯·æŠ•èµ„è®¸å¯", en: "Inv. License" } }, 
                    { dept: "MC", txt: { zh: "å•†ä¸šç™»è®° (CR)", en: "Comm. Registration" } }, 
                    { dept: "ZATCA", txt: { zh: "ç¨åŠ¡ç™»è®°", en: "Tax Reg." } }
                ] 
            },
            { 
                title: { zh: "2. æ‹¿åœ°è§„åˆ’", en: "2. Land & Zoning" }, 
                desc: { zh: "é”å®šé¡¹ç›®ç”¨åœ°", en: "Securing the Plot" }, 
                tasks: [
                    { dept: "NHC", txt: { zh: "æ´½è°ˆåœŸåœ°åˆä½œ", en: "Land Agmt." } }, 
                    { dept: "RCRC", txt: { zh: "2030åˆè§„å®¡æŸ¥", en: "Strategy Check" } }, 
                    { dept: "MOMAH", txt: { zh: "Zoningç”¨é€”å˜æ›´", en: "Zoning Change" } }
                ] 
            },
            { 
                title: { zh: "3. å»ºè®¾å®¡æ‰¹", en: "3. Permitting" }, 
                desc: { zh: "ä»å›¾çº¸åˆ°åŠ¨å·¥", en: "Design to Construction" }, 
                tasks: [
                    { dept: "Etmam", txt: { zh: "ç»¼åˆå®¡æ‰¹é€šé“", en: "Master Approval" } }, 
                    { dept: "Balady", txt: { zh: "ç”³è¯·æ–½å·¥è®¸å¯è¯", en: "Building Permit" } }, 
                    { dept: "Wafi", txt: { zh: "æœŸæˆ¿é”€å”®è®¸å¯", en: "Off-plan License" } }
                ] 
            },
            { 
                title: { zh: "4. éªŒæ”¶äº¤ä»˜", en: "4. Completion" }, 
                desc: { zh: "åˆè§„è½¬ä¸ºèµ„äº§", en: "Handover" }, 
                tasks: [
                    { dept: "Civil Def", txt: { zh: "æ¶ˆé˜²éªŒæ”¶ (æ ¸å¿ƒ)", en: "Fire Inspection" } }, 
                    { dept: "Amanah", txt: { zh: "å®Œå·¥è¯ç”³è¯·", en: "Completion Cert." } }, 
                    { dept: "Mullak", txt: { zh: "ä¸šä¸»åä¼šæ³¨å†Œ", en: "HOA Reg." } }
                ] 
            },
            { 
                title: { zh: "5. è¿è¥ç®¡ç†", en: "5. Operation" }, 
                desc: { zh: "é•¿æœŸæ”¶ç›Š", en: "Asset Mgmt" }, 
                tasks: [
                    { dept: "Ejar", txt: { zh: "ç§ŸèµåˆåŒå¤‡æ¡ˆ", en: "Lease Record" } }, 
                    { dept: "Tourism", txt: { zh: "æœåŠ¡å…¬å¯“æ‰§ç…§", en: "Hospitality Lic." } }, 
                    { dept: "ZATCA", txt: { zh: "ç¨åŠ¡ç”³æŠ¥", en: "Tax Filing" } }
                ] 
            }
        ];

        // --- RENDER FUNCTIONS ---

        // Helper to get translation safely
        const t = (key) => translations[currentLang][key] || key;
        const dt = (obj) => obj[currentLang] || obj['zh'] || "";

        function renderDirectory(filterType = 'all', searchVal = '') {
            const grid = document.getElementById('directory-grid');
            grid.innerHTML = '';
            
            const filtered = agencyData.filter(d => {
                const matchType = filterType === 'all' || d.type === filterType;
                // Search both English and Chinese names
                const matchSearch = d.name.zh.includes(searchVal) || 
                                    d.name.en.toLowerCase().includes(searchVal.toLowerCase()) || 
                                    d.abbr.toLowerCase().includes(searchVal.toLowerCase());
                return matchType && matchSearch;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-3 text-center py-10 text-gray-400">${t('dir_no_result')}</div>`;
                return;
            }

            filtered.forEach(d => {
                let colorClass = 'border-l-4 border-sand-200';
                let tagClass = 'bg-sand-100 text-slate-600';
                
                if(d.type === 'ministry') { colorClass = 'border-l-4 border-saudi-green'; tagClass = 'bg-saudi-green text-white'; }
                if(d.type === 'authority') { colorClass = 'border-l-4 border-gold-accent'; tagClass = 'bg-gold-accent text-white'; }
                if(d.type === 'execution') { colorClass = 'border-l-4 border-slate-500'; tagClass = 'bg-slate-500 text-white'; }
                if(d.type === 'partner') { colorClass = 'border-l-4 border-saudi-green-light'; tagClass = 'bg-saudi-green-light text-white'; }
                if(d.type === 'platform') { colorClass = 'border-l-4 border-sand-200'; tagClass = 'bg-sand-200 text-slate-800'; }

                grid.innerHTML += `
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-sand-100 hover:shadow-md transition-all ${colorClass} group flex flex-col h-full">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-bold text-xl text-slate-800">${d.abbr}</h3>
                            <span class="text-[10px] px-2 py-1 rounded ${tagClass} font-bold">${dt(d.role)}</span>
                        </div>
                        <h4 class="text-sm font-bold text-gray-700 mb-2">${dt(d.name)}</h4>
                        <p class="text-xs text-gray-500 mb-4 h-10 overflow-hidden leading-relaxed">${dt(d.desc)}</p>
                        
                        <div class="mt-auto">
                            <details class="text-xs text-gray-600 border-t border-sand-100 pt-2 cursor-pointer group/details">
                                <summary class="list-none font-bold text-saudi-green-light flex items-center gap-1 hover:underline select-none">
                                    <span>${t('dir_expand')}</span>
                                    <svg class="w-3 h-3 transition-transform group-open/details:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                </summary>
                                <p class="mt-2 p-2 bg-sand-50 rounded text-gray-700 border border-sand-100 leading-relaxed">${dt(d.details)}</p>
                            </details>
                        </div>
                    </div>
                `;
            });
        }

        function renderWorkflow(activeIndex = 0) {
            const stepsDiv = document.getElementById('workflow-steps-container');
            const contentDiv = document.getElementById('workflow-content');
            
            stepsDiv.innerHTML = workflowSteps.map((s, i) => `
                <button onclick="renderWorkflow(${i})" class="w-full text-left px-5 py-4 rounded-xl border transition-all flex items-center justify-between group ${i===activeIndex ? 'bg-white border-gold-accent shadow-md ring-1 ring-gold-accent z-10 relative' : 'bg-white border-sand-200 hover:bg-sand-50 text-gray-500 hover:border-gold-accent/50'}">
                    <div>
                        <div class="font-bold text-sm ${i===activeIndex ? 'text-saudi-green' : 'group-hover:text-saudi-green transition-colors'}">${dt(s.title)}</div>
                        <div class="text-xs mt-1 ${i===activeIndex ? 'text-gold-accent' : 'text-gray-400'}">${dt(s.desc)}</div>
                    </div>
                    ${i===activeIndex ? '<svg class="w-5 h-5 text-gold-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>' : ''}
                </button>
            `).join('');

            const step = workflowSteps[activeIndex];
            contentDiv.innerHTML = `
                <div class="relative z-10 animate-fade-in">
                    <div class="text-xs font-bold text-gold-accent uppercase tracking-widest mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-gold-accent animate-pulse"></span>
                        ${t('flow_step_label')}
                    </div>
                    <h3 class="text-3xl font-bold text-saudi-green mb-1">${dt(step.title)}</h3>
                    <p class="text-gray-500 mb-8 font-medium">${dt(step.desc)}</p>
                    
                    <div class="space-y-4">
                        ${step.tasks.map((t, idx) => `
                            <div class="flex items-center p-4 bg-sand-50 rounded-lg border border-sand-200 hover:border-saudi-green/30 transition-colors" style="animation: fadeIn 0.3s ease-out both; animation-delay: ${idx * 0.1}s">
                                <span class="px-2 py-1 rounded bg-saudi-green text-white text-xs font-bold mr-4 min-w-[70px] text-center shadow-sm">${t.dept}</span>
                                <span class="text-sm text-gray-700 font-medium">${dt(t.txt)}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="absolute -bottom-16 -right-12 text-[200px] font-bold text-sand-100/50 select-none pointer-events-none">${activeIndex+1}</div>
            `;
        }

        function renderLaws() {
            const container = document.getElementById('legal-list');
            container.innerHTML = lawsData.map(law => `
                <div class="bg-white border border-sand-200 rounded-lg overflow-hidden hover:shadow-md transition-all group">
                    <details class="group">
                        <summary class="flex justify-between items-center p-5 cursor-pointer list-none bg-white hover:bg-sand-50 transition-colors">
                            <div class="flex-1">
                                <h4 class="font-bold text-slate-800 text-lg group-open:text-saudi-green transition-colors flex items-center gap-3">
                                    ${dt(law.title)}
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-sand-100 text-saudi-green border border-saudi-green/10">${law.date}</span>
                                </h4>
                            </div>
                            <div class="bg-sand-100 rounded-full p-1 ml-4 group-open:bg-saudi-green group-open:text-white transition-colors">
                                <svg class="w-5 h-5 text-gray-500 group-open:text-white transform group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </summary>
                        <div class="p-6 border-t border-sand-100 bg-sand-50 text-sm text-gray-600 leading-relaxed">
                            <div class="flex gap-3">
                                <div class="w-1 bg-gold-accent rounded-full shrink-0"></div>
                                <div>
                                    <span class="font-bold text-saudi-green block mb-1">${t('law_impact')}</span>
                                    ${dt(law.desc)}
                                </div>
                            </div>
                        </div>
                    </details>
                </div>
            `).join('');
        }

        function renderComparison() {
            // Renders the Comparison Accordion using translations
            const container = document.getElementById('comparison-container');
            container.innerHTML = `
                <details class="group" open>
                    <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-5 bg-gradient-to-r from-sand-50 to-white hover:bg-sand-100 transition-colors">
                        <span class="text-saudi-green font-bold flex items-center gap-3 text-lg">
                            <div class="p-1.5 bg-saudi-green/10 rounded-full">
                                <svg class="w-5 h-5 text-saudi-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            ${t('comp_title')}
                        </span>
                        <span class="transition-transform duration-300 group-open:rotate-180 text-saudi-green bg-white rounded-full p-1 shadow-sm">
                            <svg fill="none" height="20" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="20"><path d="M6 9l6 6 6-6"></path></svg>
                        </span>
                    </summary>
                    <div class="text-gray-600 text-sm p-6 border-t border-sand-200 leading-relaxed bg-white">
                        <div class="w-full">
                            <h4 class="font-bold text-slate-800 mb-4 text-base border-l-4 border-gold-accent pl-3">${t('comp_core_diff')}</h4>
                            <p class="mb-4 text-slate-600">${t('comp_intro')}</p>
                            <ul class="space-y-4 text-slate-600">
                                <li class="flex items-start gap-4">
                                    <span class="font-bold text-saudi-green min-w-[160px] md:min-w-[200px] shrink-0">${t('comp_ministry')}</span>
                                    <span>${t('comp_ministry_desc')}</span>
                                </li>
                                <li class="flex items-start gap-4">
                                    <span class="font-bold text-gold-accent min-w-[160px] md:min-w-[200px] shrink-0">${t('comp_authority')}</span>
                                    <span>${t('comp_authority_desc')}</span>
                                </li>
                                <li class="flex items-start gap-4">
                                    <span class="font-bold text-slate-500 min-w-[160px] md:min-w-[200px] shrink-0">${t('comp_amanah')}</span>
                                    <span>${t('comp_amanah_desc')}</span>
                                </li>
                                <li class="flex items-start gap-4">
                                    <span class="font-bold text-slate-500 min-w-[160px] md:min-w-[200px] shrink-0">${t('comp_gre')}</span>
                                    <span>${t('comp_gre_desc')}</span>
                                </li>                       
                            </ul>
                        </div>
                    </div>
                </details>
            `;
        }

        // --- UI UTILS ---

        function initFilters() {
            const container = document.getElementById('filter-container');
            const filters = [
                {id: 'all', txt: 'dir_filter_all'},
                {id: 'ministry', txt: 'dir_filter_ministry'},
                {id: 'authority', txt: 'dir_filter_authority'},
                {id: 'execution', txt: 'dir_filter_execution'},
                {id: 'platform', txt: 'dir_filter_platform'},
                {id: 'partner', txt: 'dir_filter_partner'}
            ];
            container.innerHTML = filters.map(f => `
                <button onclick="applyFilter('${f.id}')" class="filter-btn px-4 py-1.5 rounded-full text-xs font-bold border border-sand-200 hover:bg-sand-100 text-slate-500 transition-all hover:shadow-sm" data-id="${f.id}">
                    <span data-i18n="${f.txt}">${t(f.txt)}</span>
                </button>
            `).join('');
            // Set All active
            applyFilter('all');
        }

        function applyFilter(type) {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.className = 'filter-btn px-4 py-1.5 rounded-full text-xs font-bold border border-sand-200 hover:bg-sand-100 text-slate-500 transition-all hover:shadow-sm';
            });
            const activeBtn = document.querySelector(`[data-id="${type}"]`);
            if(activeBtn) {
                activeBtn.className = 'filter-btn px-4 py-1.5 rounded-full text-xs font-bold bg-saudi-green text-white border-transparent shadow-md transform scale-105';
            }
            
            renderDirectory(type, document.getElementById('searchInput').value);
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('block');
            });
            const target = document.getElementById(sectionId);
            target.classList.remove('hidden');
            target.classList.add('block');

            document.querySelectorAll('.nav-item').forEach(el => {
                if(el.dataset.target === sectionId) {
                    el.classList.add('bg-white/10', 'text-white', 'shadow-inner');
                    el.classList.remove('opacity-80');
                } else {
                    el.classList.remove('bg-white/10', 'text-white', 'shadow-inner');
                    el.classList.add('opacity-80');
                }
            });

            if(window.innerWidth < 1024) {
                 document.getElementById('sidebar').classList.add('-translate-x-full');
                 document.getElementById('sidebar-overlay').classList.add('hidden');
            }
        }

        // --- LANGUAGE SWITCHING LOGIC ---
        function switchLanguage() {
            // Toggle Language
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            
            // Update HTML Lang attribute
            document.documentElement.lang = currentLang === 'zh' ? 'zh-CN' : 'en';

            // Update all static text with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if(translations[currentLang][key]) {
                    el.innerHTML = translations[currentLang][key];
                }
            });

            // Update Input Placeholders
            document.getElementById('searchInput').placeholder = t('search_placeholder');
            document.getElementById('user-input').placeholder = t('ai_input_placeholder');

            // Re-render dynamic sections
            renderComparison(); // Accordion
            renderWorkflow();
            initFilters(); // Re-render filter buttons text
            renderDirectory();
            renderLaws();
            resetAIChat();
        }

        function resetAIChat() {
             const chatBox = document.getElementById('chat-messages');
             chatBox.innerHTML = ''; // Clear chat
             
             // Initial Welcome
             const bubble = document.createElement('div');
             bubble.className = 'chat-bubble ai animate-fade-in';
             bubble.innerHTML = t('ai_welcome');
             chatBox.appendChild(bubble);

             // Suggestions
             const suggestionContainer = document.createElement('div');
             suggestionContainer.className = 'flex flex-wrap gap-2 mt-2 px-1';
             suggestionContainer.id = 'chat-suggestions';
             
             const qs = [t('ai_q1'), t('ai_q2'), t('ai_q3')];
             qs.forEach(q => {
                 suggestionContainer.innerHTML += `<button onclick="askQuestion('${q}')" class="text-xs bg-white border border-sand-200 px-3 py-1.5 rounded-full hover:border-saudi-green hover:text-saudi-green transition shadow-sm">${q}</button>`;
             });
             chatBox.appendChild(suggestionContainer);
        }

        // --- Gemini AI Logic (Mock for Demo) ---
        const apiKey = ""; 
        
        async function callGemini(userQuery) {
            await new Promise(r => setTimeout(r, 1000)); // Simulate delay
            
            const isEn = currentLang === 'en';
            
            // Simple keyword matching for demo
            if (userQuery.includes("REGA") || userQuery.includes("MOMAH")) {
                return isEn 
                    ? "<strong>MOMAH</strong> (Ministry of Municipal & Rural Affairs and Housing) is the supreme authority creating policies.<br><br><strong>REGA</strong> (Real Estate General Authority) is the regulator enforcing rules (licensing, Ejar). MOMAH sets the rules; REGA ensures everyone follows them."
                    : "<strong>MOMAH (å¸‚æ”¿ä¸ä½æˆ¿éƒ¨)</strong> æ˜¯åˆ¶å®šæ”¿ç­–çš„æœ€é«˜éƒ¨é—¨ï¼Œç›¸å½“äºæˆ‘ä»¬çš„â€œå¨˜å®¶â€ã€‚\n\nè€Œ <strong>REGA (æˆ¿åœ°äº§æ€»å±€)</strong> æ˜¯ç›‘ç®¡æœºæ„ï¼Œè´Ÿè´£å…·ä½“çš„è¡Œä¸šç›‘ç®¡ï¼Œæ¯”å¦‚ç»™ä¸­ä»‹å‘ç‰Œã€ç®¡ç†ç§Ÿèµå¹³å°ã€‚ç®€å•æ¥è¯´ï¼ŒMOMAHæ˜¯å®šè§„çŸ©çš„ï¼ŒREGAæ˜¯ç›¯ç€å¤§å®¶å®ˆè§„çŸ©çš„ã€‚";
            } else if (userQuery.includes("æµç¨‹") || userQuery.includes("Flow") || userQuery.includes("Process")) {
                return isEn
                    ? "Core Development Process:<br>1. <strong>Entry</strong>: MISA License.<br>2. <strong>Land</strong>: Secure land via NHC or private purchase (check RCRC strategy).<br>3. <strong>Build</strong>: Approvals via Etmam & Permits via Balady.<br>4. <strong>Sell</strong>: Off-plan license via Wafi."
                    : "æ‹¿åœ°å¼€å‘çš„æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š\n1. **å¸‚åœºå‡†å…¥**ï¼šå…ˆæå®šMISAæŠ•èµ„è®¸å¯ã€‚\n2. **æ‹¿åœ°**ï¼šæ‰¾NHCåˆä½œæ‹¿åœ°ï¼Œæˆ–è€…è´­ä¹°ç§åœ°ï¼Œéœ€è¦è¿‡RCRCçš„æˆ˜ç•¥å®¡æŸ¥ã€‚\n3. **å»ºè®¾**ï¼šé€šè¿‡Etmamèµ°ç»¿è‰²é€šé“ï¼Œåœ¨Baladyä¸Šæ‹¿æ–½å·¥è¯ã€‚\n4. **é”€å”®**ï¼šå¦‚æœæ˜¯æœŸæˆ¿ï¼Œå¿…é¡»æ‹¿åˆ°Wafiè®¸å¯ã€‚";
            } else {
                return isEn
                    ? "This is a question about the Smart Oasis internal knowledge base. Based on our data, the Saudi market uses a flat management structure. Please ask about specific agencies like NHC or Amanah."
                    : "è¿™æ˜¯ä¸€ä¸ªå…³äºSmart Oasiså†…éƒ¨çŸ¥è¯†åº“çš„å¥½é—®é¢˜ã€‚æ ¹æ®æˆ‘ä»¬çš„èµ„æ–™ï¼Œæ²™ç‰¹æˆ¿åœ°äº§å¸‚åœºå‘ˆç°æ‰å¹³åŒ–ç®¡ç†ç‰¹å¾ã€‚å¦‚æœæ‚¨éœ€è¦å…³äºå…·ä½“æœºæ„ï¼ˆå¦‚NHC, Amanahï¼‰çš„ç»†èŠ‚ï¼Œè¯·å…·ä½“è¯¢é—®ã€‚";
            }
        }

        // --- Chat UI Logic ---
        function toggleAIChat() {
            const panel = document.getElementById('ai-chat-panel');
            const overlay = document.getElementById('chat-overlay');
            
            if (panel.classList.contains('translate-x-full')) {
                panel.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                document.getElementById('user-input').focus();
            } else {
                panel.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        function appendMessage(text, sender) {
            const chatBox = document.getElementById('chat-messages');
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender} animate-fade-in`;
            
            if (sender === 'ai') {
                let formattedText = text.replace(/\n/g, '<br>');
                formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong class="text-saudi-green">$1</strong>');
                bubble.innerHTML = formattedText;
            } else {
                bubble.textContent = text;
            }
            
            chatBox.appendChild(bubble);
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }

        function appendLoading() {
            const chatBox = document.getElementById('chat-messages');
            const bubble = document.createElement('div');
            bubble.id = 'loading-bubble';
            bubble.className = 'chat-bubble ai';
            bubble.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            chatBox.appendChild(bubble);
            chatBox.scrollTo({ top: chatBox.scrollHeight, behavior: 'smooth' });
        }

        function removeLoading() {
            const bubble = document.getElementById('loading-bubble');
            if (bubble) bubble.remove();
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text) return;

            appendMessage(text, 'user');
            input.value = '';
            appendLoading();

            const response = await callGemini(text);

            removeLoading();
            appendMessage(response, 'ai');
        }
        
        function askQuestion(question) {
            const input = document.getElementById('user-input');
            input.value = question;
            sendMessage();
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        document.getElementById('menu-btn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.remove('-translate-x-full');
            document.getElementById('sidebar-overlay').classList.remove('hidden');
        });

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderComparison();
            renderWorkflow();
            initFilters();
            renderDirectory();
            renderLaws();
            resetAIChat();
            
            document.getElementById('searchInput').addEventListener('input', (e) => renderDirectory('all', e.target.value));
            
            showSection('dashboard'); // Default View
        });

    </script>
</body>
</html>
